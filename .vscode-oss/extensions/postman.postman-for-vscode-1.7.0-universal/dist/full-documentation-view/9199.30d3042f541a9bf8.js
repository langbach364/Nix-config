"use strict";(self.webpackChunkfull_documentation_view=self.webpackChunkfull_documentation_view||[]).push([[9199],{249199:(e,t,r)=>{r.r(t),r.d(t,{CollectionPermissionNames:()=>Z,CollectionPermissions:()=>Q,ENABLE_COLLECTIONS:()=>Ot,collectionFindOneQuery:()=>M,collectionFindTagsQuery:()=>W,collectionPermissionsQuery:()=>X,collectionVariablesHandler:()=>_t,composeUID:()=>l,createCollection:()=>I,createRequest:()=>ye,decomposeUID:()=>i,deleteResponse:()=>ce,duplicateCollection:()=>E,fetchPermissions:()=>R,findOneFolder:()=>A,findOneRequest:()=>V,findParentFolderById:()=>st,folderFindOneQuery:()=>H,folderFindOneSelectCollectionQuery:()=>j,getActiveCollectionSession:()=>kt,getBreadcrumbItems:()=>Ft,getCollectionList:()=>y,getCollectionListQuery:()=>ne,getResponseData:()=>P,getResponseMetaData:()=>ie,getUserInfo:()=>we,getWorkspacePermissionsQuery:()=>ae,isUID:()=>c,patchCollection:()=>$,requestFindOneQuery:()=>x,requestFindOneSelectCollectionQuery:()=>Y,responseFindOneQuery:()=>B,responseFindOneSelectCollectionQuery:()=>N,transferRequest:()=>Ie,transferResponse:()=>ue,updateCollection:()=>T,updateCollectionMutation:()=>ht,updateCollectionRoles:()=>S,updateFolder:()=>F,updateFolderMutation:()=>bt,updateRequest:()=>fe,updateRequestCollection:()=>vt,updateRequestMutation:()=>mt,updateResponse:()=>le,updateResponseMutation:()=>qt,useCollectionList:()=>Ye,useCollectionListRawQuery:()=>xe,useCollectionListSubscription:()=>Ve,useCollectionSubscription:()=>je,useCreateNewCollection:()=>Xe,useCreateNewFolder:()=>nt,useCreateRequest:()=>pt,useCreateResponse:()=>$t,useDeleteCollection:()=>et,useDeleteFolder:()=>dt,useDeleteRequest:()=>ft,useDeleteResponse:()=>Rt,useDuplicateCollection:()=>ze,useDuplicateFolder:()=>lt,useDuplicateRequest:()=>yt,useDuplicateResponse:()=>Et,useMoveFolder:()=>ut,useMoveRequest:()=>wt,useResponseMeta:()=>Ct,useResponseMetaUpdateMutation:()=>At,useUpdateCollectionRoles:()=>Pt,useUpdateFolderInList:()=>ct,useUpdateRequestInList:()=>It,useUpdateUpdateCollectionInList:()=>rt,useWorkspacePermissions:()=>ot});var o=r(607560),a=r(45860),s=r(926663),n=r.n(s);const d="-",l=(e,t)=>{const r=e.split(d);return!r||!t||r.length>=6?e:`${t}${d}${e}`},i=e=>{const t="string"==typeof e&&e.split(d);return!t||t.length<6?{id:e}:{owner:t.shift(),id:t.join(d)}},c=e=>{const t=e.split(d);return!!(Array.isArray(t)&&t.length>=6)},u=(e,t)=>{const r=e.responses_order.map((e=>c(e)?e:l(e,t)));return(0,o.Z)({},e,{responses_order:r})},p=(e,t)=>{const r=e.folders_order.map((e=>c(e)?e:l(e,t))),a=e.order.map((e=>c(e)?e:l(e,t))),s=e.folders.map((e=>p(e,t))),n=e.requests.map((e=>u(e,t)));return(0,o.Z)({},e,{folders:s,requests:n,folders_order:r,order:a})},f=(e,t)=>{const r=e.folders_order.map((e=>c(e)?e:l(e,t))),a=e.order.map((e=>c(e)?e:l(e,t))),s=e.folders.map((e=>p(e,t))),n=e.requests.map((e=>u(e,t)));return(0,o.Z)({},e,{folders:s,requests:n,folders_order:r,order:a})},y=async({workspaceId:e,ids:t,includeResponse:r})=>e?(e=>{const t={data:[]};if(null==e||!Array.isArray(e.data))return t;for(const r of e.data){const{owner:e}=i(r.id);e?t.data.push(f(r,e)):t.data.push(r)}return t})(await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/list/collection`,query:{workspace:e},body:JSON.stringify({ids:t,exclude:{responses:!r,flags:{isArchived:!0,isFavorite:!0}}})})):{data:[]},I=async({signal:e,workspaceId:t,requestBody:r})=>await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collection/import`,query:{workspace:t},body:JSON.stringify(r),signal:e});function w(e){return e&&"object"==typeof e&&(e.id&&(e.id=l(e.id,e.owner)),e.request&&"string"==typeof e.request&&(e.request=l(e.request,e.owner))),e}function h(e){if(e&&"object"==typeof e&&(e.id&&(e.id=l(e.id,e.owner)),e.collection&&"string"==typeof e.collection&&(e.collection=l(e.collection,e.owner)),e.folder&&"string"==typeof e.folder&&(e.folder=l(e.folder,e.owner)),e.responses_order&&(e.responses_order=e.responses_order.map((t=>l(t,e.owner)))),e.responses))for(const t of e.responses)w(t);return e}function b(e){if(e&&"object"==typeof e){if(e.id&&(e.id=l(e.id,e.owner)),e.folder&&"string"==typeof e.folder&&(e.folder=l(e.folder,e.owner)),e.collection&&"string"==typeof e.collection&&(e.collection=l(e.collection,e.owner)),e.folders_order&&(e.folders_order=e.folders_order.map((t=>l(t,e.owner)))),e.folders)for(const t of e.folders)b(t);if(e.order&&(e.order=e.order.map((t=>l(t,e.owner)))),e.requests)for(const t of e.requests)h(t)}return e}function g(e){if(e&&"object"==typeof e){if(e.id&&(e.id=l(e.id,e.owner)),e.folders_order&&(e.folders_order=e.folders_order.map((t=>l(t,e.owner)))),e.folders)for(const t of e.folders)b(t);if(e.order&&(e.order=e.order.map((t=>l(t,e.owner)))),e.requests)for(const t of e.requests)h(t);e.variables&&(e.variables=q(e.variables))}return e}function q(e){return null==e?void 0:e.map((e=>e.disabled?(0,o.Z)({},e,{enabled:!1}):(0,o.Z)({},e,{enabled:!0})))}function m(e){return g(e.data),e}function v(e,t){return e&&e.folder&&v(e.folder,t),e.id&&t&&(e.id=l(e.id,t)),e}function _(e){var t,r,o,a,s,n,d,i,c,u,p,f,y,I,w,h,b,g;return null!=e&&null!=(t=e.data)&&t.collection&&"string"==typeof e.data.collection&&null!=e&&null!=(r=e.data)&&r.owner&&(e.data.collection=l(e.data.collection,e.data.owner)),"object"==typeof e.data.collection&&null!=e&&null!=(o=e.data)&&o.owner&&e.data.collection.id&&(e.data.collection.id=l(e.data.collection.id,e.data.owner)),"object"==typeof e.data.collection&&null!=e&&null!=(a=e.data)&&null!=(a=a.collection)&&a.variables&&(e.data.collection.variables=q(e.data.collection.variables)),null!=e&&null!=(s=e.data)&&s.id&&null!=e&&null!=(n=e.data)&&n.owner&&(e.data.id=l(e.data.id,e.data.owner)),null!=e&&null!=(d=e.data)&&d.folder&&"object"==typeof(null==e||null==(i=e.data)?void 0:i.folder)&&null!=e&&null!=(c=e.data)&&c.owner&&v(e.data.folder,e.data.owner),null!=e&&null!=(u=e.data)&&u.folder&&"string"==typeof(null==e||null==(p=e.data)?void 0:p.folder)&&null!=e&&null!=(f=e.data)&&f.owner&&(e.data.folder=l(e.data.folder,e.data.owner)),k(e)&&null!=e&&null!=(y=e.data)&&y.request&&"object"==typeof(null==e||null==(I=e.data)?void 0:I.request)&&null!=e&&null!=(w=e.data)&&w.owner&&(e.data.request.id=l(e.data.request.id,e.data.owner)),k(e)&&null!=e&&null!=(h=e.data)&&h.request&&"string"==typeof(null==e||null==(b=e.data)?void 0:b.request)&&null!=e&&null!=(g=e.data)&&g.owner&&(e.data.request=l(e.data.request,e.data.owner)),e}function k(e){return e&&e.data&&void 0!==e.data.request}var C=r(685692);const T=async({collectionId:e,patch:t,signal:r,options:s})=>{var d;if(!e)throw new Error("CollectionService~updateCollection: collectionId is a required parameter");(e=>{if(Array.isArray(e.variables)&&e.variables.length>0){var t;const r=null==(t=e.variables)?void 0:t.map((e=>"boolean"==typeof e.enabled?(0,o.Z)({},e,{disabled:!e.enabled}):(0,o.Z)({},e)));e.variables=r}})(t);const l=m(await a.postmanGateway.put({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,body:JSON.stringify(t),signal:r}));return null!=s&&s.avoidSession||null==l||null==(d=l.data)||!d.id||await(0,C.updateDependentSession)({model:"collection",modelId:l.data.id},{values:l.data.variables||[]}),l},E=async({workspaceId:e,collectionId:t,signal:r})=>await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collection/${t}/duplicate`,query:{workspace:e},headers:{"Content-type":"text/plain"},signal:r}),R=async({permissions:e,signal:t})=>function(e){const t=Object.keys(e),r={};for(const o of t)r[o.split(":")[1]]=e[o];return r}((await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",method:"POST",service:"acs",data:{body:e},signal:t})).results),S=async({signal:e,collectionId:t,roles:r})=>await a.postmanGateway.put({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collection/roles/${t}`,data:{roles:r},signal:e}),$=async({patch:e,signal:t})=>await a.postmanGateway.patch({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collection`,body:JSON.stringify(e),signal:t}),A=async({folderId:e,populate:t="parent",signal:r})=>{try{return e?_(await a.postmanGateway.get({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,query:{populate:t},signal:r})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}},F=async({folderId:e,patch:t,signal:r})=>{if(!e)throw new Error("CollectionService~updateFolder: folderId is a required parameter");return _(await a.postmanGateway.put({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,body:JSON.stringify(t),signal:r}))},P=async({responseId:e,populate:t="parent",signal:r})=>{try{return e?_(await a.postmanGateway.get({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,query:{populate:t},signal:r})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}};var O=r(297201);const L="collection-find-one",G="folder-find-one",U="response-find-one",D="request-find-one",K="collection-permissions",M=({signal:e,collectionId:t,populate:r=!1})=>({queryKey:r?[L,t,{populate:r}]:[L,t],queryFn:()=>(async({collectionId:e,signal:t,populate:r=!1})=>{var o;if(!e)return{model_id:"",meta:{},data:{}};const s=m(await a.postmanGateway.get({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,query:{populate:r},signal:t}));return null!=s&&null!=(o=s.data)&&o.variables&&await(0,C.updateDependentSession)({model:"collection",modelId:e},{values:s.data.variables}),s})({collectionId:t,signal:e,populate:r}),enabled:!!t,useErrorBoundary:!1}),W=({signal:e,collectionId:t})=>({queryKey:["collection-find-tags",t],queryFn:()=>(async({collectionId:e,signal:t})=>e?(await a.postmanGateway.get({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collections/${e}/tags?count=100`,signal:t})).tags:[])({collectionId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),H=({signal:e,folderId:t,populate:r="parent"})=>({queryKey:[G,t],queryFn:()=>A({folderId:t,populate:r,signal:e}),enabled:!!t,useErrorBoundary:!1}),j=({signal:e,folderId:t})=>(0,o.Z)({},H({signal:e,folderId:t||""}),{enabled:!!t,select:e=>e.data.collection}),V=async({requestId:e,populate:t=!1,signal:r})=>{var o;const s=_(await a.postmanGateway.get({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,query:{populate:t},signal:r}));if("object"==typeof(null==s||null==(o=s.data)?void 0:o.collection)){const e=s.data.collection;await(0,C.updateDependentSession)({model:"collection",modelId:e.id},{values:e.variables||[]})}return s},x=({requestId:e})=>({queryKey:[D,e],queryFn:async({signal:t})=>V({requestId:e,populate:"parent",signal:t}),enabled:!!e,useErrorBoundary:!1}),Y=({requestId:e})=>(0,o.Z)({},x({requestId:null!=e?e:""}),{enabled:!!e,select:e=>e.data.collection}),B=({signal:e,responseId:t})=>({queryKey:[U,t],queryFn:async()=>P({responseId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),N=({responseId:e})=>(0,o.Z)({},B({responseId:null!=e?e:""}),{enabled:!!e,select:e=>e.data.collection}),Q={EDIT:"edit",DELETE:"delete"},Z={UPDATE_COLLECTION:"UPDATE_COLLECTION",DELETE_COLLECTION:"DELETE_COLLECTION"};function J(e,t){const r={};for(const o of Object.keys(Z))r[`${t}:${o}`]={entityId:e,entityType:"user",permission:o,objectType:"collection",objectId:t};return{checks:r}}const X=({signal:e,collectionId:t})=>({queryKey:[K,t],queryFn:()=>R({permissions:J(window.USER_ID,t),signal:e}),enabled:!!t,useErrorBoundary:!1}),z="ADD_COLLECTION_TO_WORKSPACE",ee="ADD_COLLECTIONRUN_TO_WORKSPACE",te="REMOVE_HISTORY_FROM_WORKSPACE",re="workspace",oe="user",ae=e=>({queryKey:["workspace",K,e],queryFn:({signal:t})=>(async({signal:e,workspaceId:t})=>{var r,s,d;let l={};const i=`workspace/${t}/${z}`,c=`workspace/${t}/${ee}`,u=`workspace/${t}/${te}`,p={[i]:{entityId:window.USER_ID,entityType:oe,objectId:t,objectType:re,permission:z},[c]:{entityId:window.USER_ID,entityType:oe,objectId:t,objectType:re,permission:ee},[u]:{entityId:window.USER_ID,entityType:oe,objectId:t,objectType:re,permission:te}};try{const t=await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",service:"acs",data:{body:{checks:(0,o.Z)({},p)}},signal:e});if(null==t||!t.results)throw new Error("Received invalid permissions");l=t.results}catch(e){return{userCanCreate:!0,userCanRunCollection:!0,userCanDeleteHistory:!1}}return{userCanCreate:null==(r=l[i])?void 0:r.allowed,userCanRunCollection:null==(s=l[c])?void 0:s.allowed,userCanDeleteHistory:null==(d=l[u])?void 0:d.allowed}})({signal:t,workspaceId:e}),enabled:!!e,useErrorBoundary:!1}),se="collection-list";function ne({workspaceId:e,useErrorBoundary:t=!1,select:r}){return{enabled:!!e,queryKey:[se,e],queryFn:async()=>y({workspaceId:e}),useErrorBoundary:t,select:r}}const de=(e,t)=>{e&&(0,O.updateCache)({key:B({responseId:e}).queryKey,updater:e=>{if(!e)return;const r=t;return e.data.collection&&(r.data.collection=e.data.collection),e.data.folder&&(r.data.folder=e.data.folder),e.data.request&&(r.data.request=e.data.request),r}})},le=async({responseId:e,patch:t,signal:r})=>{if(!e)throw new Error("CollectionService~updateResponse: responseId is a required parameter");const o=await a.postmanGateway.put({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,body:JSON.stringify(t),signal:r});return de(e,o),_(o)},ie=async({responseId:e,signal:t})=>{try{return e?_(await a.postmanGateway.get({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,signal:t})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}},ce=async({responseId:e,signal:t})=>await a.postmanGateway.delete({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,signal:t}),ue=async({requestBody:e,signal:t})=>await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/transfer/response`,body:JSON.stringify(e),signal:t}),pe=(e,t)=>{e&&(0,O.updateCache)({key:x({requestId:e}).queryKey,updater:e=>{if(!e)return;const r=t;return e.data.collection&&(r.data.collection=e.data.collection),e.data.folder&&(r.data.folder=e.data.folder),r}})},fe=async({requestId:e,patch:t,signal:r})=>{if(!e)throw new Error("CollectionService~updateRequest: requestId is a required parameter");const o=await a.postmanGateway.put({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,body:JSON.stringify(t),signal:r});return pe(e,o),_(o)},ye=async({request:e,signal:t})=>{if(!e)throw new Error("CollectionService~createRequest: invalid parameters");return _(await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/request/import?collection=${e.collection}`,body:JSON.stringify(e),signal:t}))},Ie=async({requestBody:e,signal:t})=>await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/transfer/request`,body:JSON.stringify(e),signal:t}),we=async({type:e,userIds:t,populate:r,signal:o})=>{const s={type:e,ids:t};r&&(s.populate=r);const d=await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/public_profile",service:"ums",method:"post",data:{body:s},signal:o});if(!d)throw new Error("Received invalid users");return d.users};var he=r(540540);const be=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.collectionId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({collectionId:t=e.collectionId,workspaceId:r=e.workspaceId,subscribingEntity:o=null,subscriptionHandler:s}){if(""===t)return;if(e.observer||e.asyncObserver)return;const{asyncObserver:n,abortController:d}=(e=>{const t=new AbortController;return{asyncObserver:a.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",service:"sync",url:`/collection/${e}/subscribe`,data:{}},subscriptionEvents:["update","update_roles","destroy","import","create"],responseFilter:e=>{var t;return null==e||null==(t=e.body)?void 0:t.model_id},broadcastFilter:e=>{var t;return i(null==e||null==(t=e.meta)||null==(t=t.timeline)?void 0:t.model_id).id},unsubscribeRequest:{method:"delete",service:"sync",url:`/collection/${e}/unsubscribe`,data:{}}}),abortController:t}})(t);e.abortController=d,e.asyncObserver=n,e.observer=await n,e.abortController=null,e.observer.subscribe({next:e=>{s(e,{collectionId:t,workspaceId:r,subscribingEntity:o})},complete:()=>{e.unsubscribe()},error:async function(r){e.cleanup(),await e.subscribe({subscriptionHandler:s,collectionId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}};var ge=r(814350);const qe=async(e,t,r)=>{switch(t.meta.action){case"update":{var o;"folder"===(null==r?void 0:r.type)&&(0,O.invalidateCache)([G,null==r?void 0:r.id]),"request"===(null==r?void 0:r.type)&&(0,O.invalidateCache)([D,null==r?void 0:r.id]),"response"===(null==r?void 0:r.type)&&(0,O.invalidateCache)([U,null==r?void 0:r.id]);const a=m(t);((e,t)=>{e&&(0,O.updateCache)({key:M({collectionId:e}).queryKey,updater:e=>{if(e)return t}})})(e,a),null!=a&&null!=(o=a.data)&&o.id&&await(0,C.updateDependentSession)({model:"collection",modelId:a.data.id},{values:a.data.variables||[]});break}}},me=(e,t)=>{e&&(0,O.updateCache)({key:H({folderId:e}).queryKey,updater:e=>{if(!e)return;const r=t;return e.data.collection&&(r.data.collection=e.data.collection),e.data.folder&&(r.data.folder=e.data.folder),r}})};var ve=r(619578);const _e=(e,t,r)=>{var o;const a=`${null==e||null==(o=e.data)?void 0:o.owner}-${null==e?void 0:e.model_id}`,s=(0,ve.getTabManager)();switch(e.meta.action){case"update":"folder"===(null==r?void 0:r.type)&&(null==r?void 0:r.id)!==a&&(0,O.invalidateCache)([G,null==r?void 0:r.id]),"request"===(null==r?void 0:r.type)&&(0,O.invalidateCache)([D,null==r?void 0:r.id]),"response"===(null==r?void 0:r.type)&&(0,O.invalidateCache)([U,null==r?void 0:r.id]),me(a,_(e));break;case"destroy":s.closeTabByRoute(`/workspace/${t}/folder/${a}`)}},ke=(e,t,r)=>{var o;const a=`${null==e||null==(o=e.data)?void 0:o.owner}-${null==e?void 0:e.model_id}`,s=(0,ve.getTabManager)();switch(e.meta.action){case"update":"response"===(null==r?void 0:r.type)&&(0,O.invalidateCache)([U,null==r?void 0:r.id]),pe(a,_(e));break;case"destroy":s.closeTabByRoute(`/workspace/${t}/request/${a}`)}};var Ce=r(103860),Te=r.n(Ce);function Ee(e,t){return e.folders.find((e=>e.id===t))||null}function Re(e,t){return e.requests.find((e=>e.id===t))||null}function Se(e,t){if(e.folders_order.includes(t))return e;for(const r of e.folders){const e=Se(r,t);if(e)return e}return null}function $e(e,t){if(e.folders_order.includes(t))return e;for(const r of e.folders){const e=Se(r,t);if(e)return e}return null}function Ae(e,t){if(e.order.includes(t))return e;for(const r of e.folders){const e=Ae(r,t);if(e)return e}return null}function Fe(e,t){if(e.order.includes(t))return e;for(const r of e.folders){const e=Ae(r,t);if(e)return e}return null}function Pe(e,...t){const r={};for(const o of Object.keys(e))t.includes(o)||(r[o]=e[o]);return r}function Oe(e,t,r){e&&"object"==typeof e&&(e.owner=r)}function Le(e,t,r){if(e&&"object"==typeof e&&(e.owner=r,e.collection&&"string"==typeof e.collection&&(e.collection=t),e.responses_order&&(e.responses_order=e.responses_order.map((e=>`${r}-${i(e).id}`))),e.responses))for(const t of e.responses)Oe(t,0,r)}function Ge(e,t,r){if(e&&"object"==typeof e){if(e.owner=r,e.folders_order&&(e.folders_order=e.folders_order.map((e=>`${r}-${i(e).id}`))),e.folders)for(const o of e.folders)Ge(o,t,r);if(e.order&&(e.order=e.order.map((e=>`${r}-${i(e).id}`))),e.requests)for(const o of e.requests)Le(o,t,r)}}function Ue(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Ee(e.data,t.data.folder)),r&&(Ge(t.data,e.data.id,e.data.owner),r.folders_order.push(t.data.id),e.data.folders.push(t.data)),e}const De=(e,t)=>{e&&(0,O.updateCache)({key:M({collectionId:e,populate:!0}).queryKey,updater:e=>{if(e)return Te()(e,(e=>{switch(t.type){case"collection-update":return function(e,t){const r=Pe(t.data,"folders","requests");return Object.assign(e.data,r),e}(e,t);case"collection-destroy":return e;case"folder-import":return function(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Ee(e.data,t.data.folder)),r&&(r.folders_order||(r.folders_order=[]),r.folders_order.push(t.data.id),e.data.folders||(e.data.folders=[]),e.data.folders.push(t.data)),e}(e,t);case"folder-destroy":return function(e,t){const r=$e(e.data,t.data.id);return r&&(r.folders_order=r.folders_order.filter((e=>e!==t.data.id)),e.data.folders=e.data.folders.filter((e=>e.id!==t.data.id))),e}(e,t);case"folder-update":return function(e,t){const r=Ee(e.data,t.data.id);return r?(r.collection!==t.data.collection||r.folder!==t.data.folder||Object.assign(r,t.data),e):e}(e,t);case"folder-remove":return function(e,t){const r=$e(e.data,t.data.id);return r&&(r.folders_order=r.folders_order.filter((e=>e!==t.data.id)),e.data.folders=e.data.folders.filter((e=>e.id!==t.data.id))),e}(e,t);case"folder-add":return Ue(e,t);case"request-import":return function(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Ee(e.data,t.data.folder)),r&&(r.order||(r.order=[]),r.order.push(t.data.id),e.data.requests||(e.data.requests=[]),e.data.requests.push(t.data)),e}(e,t);case"request-destroy":return function(e,t){const r=Fe(e.data,t.data.id);return r&&(r.order=r.order.filter((e=>e!==t.data.id)),e.data.requests=e.data.requests.filter((e=>e.id!==t.data.id))),e}(e,t);case"request-update":return function(e,t){const r=Re(e.data,t.data.id);if(!r)return e;const o=Pe(t.data,"responses");return r.collection!==t.data.collection||r.folder!==t.data.folder||Object.assign(r,o),e}(e,t);case"request-remove":return function(e,t){const r=Fe(e.data,t.data.id);return r&&(r.order=r.order.filter((e=>e!==t.data.id)),e.data.requests=e.data.requests.filter((e=>e.id!==t.data.id))),e}(e,t);case"request-add":return function(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Ee(e.data,t.data.folder)),r&&(Le(t.data,e.data.id,e.data.owner),r.order||(r.order=[]),r.order.push(t.data.id),e.data.requests||(e.data.requests=[]),e.data.requests.push(t.data)),e}(e,t);case"response-import":return function(e,t){if(!t.data.request||"string"!=typeof t.data.request)return e;const r=Re(e.data,t.data.request);return r&&(r.responses_order||(r.responses_order=[]),r.responses_order.push(t.data.id),r.responses||(r.responses=[]),r.responses.push(t.data)),e}(e,t);case"response-destroy":return function(e,t){const r=function(e,t){for(const r of e.requests)if(r.responses.some((e=>e.id===t)))return r;return null}(e.data,t.data.id);return r&&(r.responses_order=r.responses_order.filter((e=>e!==t.data.id)),r.responses=r.responses.filter((e=>e.id!==t.data.id))),e}(e,t);case"response-update":return function(e,t){const r=function(e,t){for(const r of e.requests){const e=r.responses.find((e=>e.id===t));if(e)return e}return null}(e.data,t.data.id);return r&&Object.assign(r,t.data),e}(e,t)}return e}))}})},Ke=(e,{collectionId:t,workspaceId:r,subscribingEntity:o})=>{switch(e.meta.model){case"collection":"update_roles"===e.meta.action&&((0,O.invalidateCache)([K,t]),(0,O.invalidateCache)([ge.ACCESS_CONTROL_QUERY_KEY_PREFIX,ge.ALL_ROLES,"collection",t])),o?qe(t,e,o):qe(t,e);break;case"folder":o?_e(e,r,o):_e(e,r);break;case"request":o?ke(e,r,o):ke(e,r);break;case"response":((e,t)=>{var r;const o=null==e||null==(r=e.data)?void 0:r.owner,a=(0,ve.getTabManager)(),s=`${o}-${null==e?void 0:e.model_id}`;switch(e.meta.action){case"update":de(s,_(e));break;case"destroy":a.closeTabByRoute(`/workspace/${t}/example/${s}`)}})(e,r)}(async e=>{var t;const r=null==(t=e.meta)||null==(t=t.timeline)?void 0:t.model_id;if(O.cacheClient.getQueryData(M({collectionId:r,populate:!0}).queryKey))if("destroy"!==e.meta.action)switch(e.meta.model){case"collection":De(r,{type:`collection-${e.meta.action}`,data:g(e.data)});break;case"folder":De(r,{type:`folder-${e.meta.action}`,data:b(e.data)});break;case"request":De(r,{type:`request-${e.meta.action}`,data:h(e.data)});break;case"response":if("create"===e.meta.action){De(r,{type:"response-import",data:w(e.data)});break}De(r,{type:"response-update",data:w(e.data)})}else De(r,{type:`${e.meta.model}-destroy`,data:{id:l(e.data.id,e.data.owner)}})})(e)},Me=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:t=e.workspaceId,subscriptionHandler:r}){if(""===t)return;if(e.workspaceId!==t&&e.changeWorkspace(t),e.observer||e.asyncObserver)return;const{asyncObserver:o,abortController:s}=(e=>{const t=new AbortController;return{asyncObserver:a.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",service:"sync",url:`/list/collection?workspace=${e}&subscribe=true`,data:{}},subscriptionEvents:["broadcast"],responseFilter:e=>{var t;return null==e||null==(t=e.body)||null==(t=t.subscription)?void 0:t.id},broadcastFilter:e=>{var t;return null==e||null==(t=e.data)||null==(t=t.subscription)?void 0:t.id},unsubscribeRequest:{method:"delete",service:"sync",url:`/list/collection/subscribe?workspace=${e}`,data:{}}}),abortController:t}})(t);e.abortController=s,e.asyncObserver=o,e.observer=await o,e.abortController=null,(0,O.invalidateCache)([se,t]),e.observer.subscribe({next:e=>{r(e,{workspaceId:t})},complete:()=>{e.unsubscribe()},error:async function(o){e.cleanup(),await e.subscribe({subscriptionHandler:r,workspaceId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}},We=({signal:e,responseId:t})=>({queryKey:["response-meta",t],queryFn:async()=>ie({responseId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),He=(e,{workspaceId:t})=>{if("broadcast"===e.meta.action&&"workspace"===e.meta.model){const r=[],o=[];"response"===e.meta.entity&&e.meta.entity_id&&(0,O.invalidateCache)(We({responseId:e.meta.entity_id}).queryKey);for(const t of e.data.data)"create"===t.action||"update"===t.action?r.push(t.id):"delete"===t.action&&o.push(t.id);r.length>0&&((e,t)=>{(async(e,t)=>{if(e&&t.length>0)try{const r=(await y({workspaceId:e,ids:t})).data,o=r.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);(0,O.updateCache)({key:ne({workspaceId:e}).queryKey,updater:e=>{if(!e)return e;const t=e.data.filter((e=>o.has(e.id))),a=new Set(t.map((e=>e.id))),s=new Set([...o.keys()].filter((e=>!a.has(e))));return(0,Ce.produce)(e,(e=>{const t=e.data.map((e=>a.has(e.id)&&o.get(e.id)||e)),n=r.filter((e=>s.has(e.id)));e.data=[...t,...n]}))}})}catch(e){}})(e,t)})(t,r),o.length>0&&((e,t)=>{(async(e,t)=>{e&&t.length>0&&(0,O.updateCache)({key:ne({workspaceId:e}).queryKey,updater:e=>e?{data:e.data.filter((e=>!t.includes(e.id)))}:e})})(e,t)})(t,o)}},je=({collectionId:e,workspaceId:t,subscribingEntity:r=null})=>{(0,he.useEffect)((()=>{if(e)return be.subscribe({collectionId:e,workspaceId:t,subscribingEntity:r,subscriptionHandler:Ke}),()=>{be.unsubscribe()}}),[e])},Ve=({workspaceId:e})=>{(0,he.useEffect)((()=>{if(e)return Me.subscribe({workspaceId:e,subscriptionHandler:He}),()=>{Me.unsubscribe()}}),[e])};function xe({workspaceId:e,select:t}){return(0,O.useDataFetch)(ne({workspaceId:e,select:t}))}const Ye=({workspaceId:e})=>{const{data:t,isError:r,refetch:o,isRefetching:a}=xe({workspaceId:e});return{data:t?t.data:null,refetch:o,hasPageError:r,isRefetching:a}};var Be=r(960398);const Ne=(e,t)=>{e&&(0,O.updateCache)({key:ne({workspaceId:e}).queryKey,updater:e=>e?e.data.find((e=>e.id===t.id))?void 0:(0,o.Z)({},e,{data:[...e.data,t]}):e})},Qe=(e,t)=>{e&&(0,O.updateCache)({key:ne({workspaceId:e}).queryKey,updater:e=>e?(0,Ce.produce)(e,(e=>{const r=e.data.map((e=>e.id===t.id?(0,o.Z)({},e,t):e));e.data=r})):e})},Ze={permissions:{userCanDelete:!0,userCanUpdate:!0}},Je={id:(0,Be.v4)(),name:"New Collection",order:[],folders_order:[],folders:[],requests:[]},Xe=()=>(0,O.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r})=>I({workspaceId:e,requestBody:t,signal:r}),onSuccess:(e,t)=>{const r=Object.assign({},Je,e.data,{id:l(e.data.id,e.data.owner)}),a=(0,o.Z)({},r,{attributes:Ze});Ne(t.workspaceId,a)}}),ze=()=>(0,O.useMutation)({mutationFn:e=>E({workspaceId:e.workspaceId,collectionId:e.collectionId,signal:e.signal}),onSuccess:async(e,t)=>{try{const r=await y({workspaceId:t.workspaceId,ids:[l(e.data.id,e.data.owner)]});Ne(t.workspaceId,r.data[0])}catch(e){}}}),et=()=>(0,O.useMutation)({mutationFn:e=>(async({collectionId:e,signal:t})=>{const r=await a.postmanGateway.delete({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,signal:t});return await(0,C.deleteDependentSession)({model:"collection",modelId:e}),r})({collectionId:e.collectionId,signal:e.signal}),onSuccess:(e,t)=>{var r,a;r=t.workspaceId,a=t.collectionId,r&&(0,O.updateCache)({key:ne({workspaceId:r}).queryKey,updater:e=>{if(!e)return e;const t=e.data.filter((e=>e.id!==a));return(0,o.Z)({},e,{data:[...t]})}}),t.onSuccess&&t.onSuccess(e)}}),tt=["requests","folders"],rt=()=>(0,O.useMutation)({mutationFn:e=>T({collectionId:e.collectionId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;(e=>{for(const t of tt)delete e[t]})(e),Qe(t.workspaceId,e)}catch(e){}}}),ot=e=>{const{data:t}=(0,O.useDataFetch)(ae(e));return null!=t?t:{userCanCreate:!0,userCanRunCollection:!1,userCanDeleteHistory:!1}},at=(e,t)=>{const r=e[0],o=e.slice(1);if(!r)return;const a=t.find((e=>e.id===r));return a?o.length>0?at(o,a.folders):a:void 0},st=(e,t)=>{let r;for(const o of t){if(o.id===e){r=o;break}!r&&o.folders.length>0&&(r=st(e,o.folders))}return r},nt=()=>(0,O.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r,collectionId:o})=>(async({requestBody:e,collectionId:t,signal:r})=>_(await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/folder/import`,query:{collection:t},body:JSON.stringify(e),signal:r})))({workspaceId:e,requestBody:t,signal:r,collectionId:o}),onSuccess:(e,t)=>{const r=e.data;((e,t,r,o)=>{e&&(0,O.updateCache)({key:ne({workspaceId:e}).queryKey,updater:e=>e?0===r.length?(0,Ce.produce)(e,(e=>{const r=e.data.find((e=>e.id===t));r&&(r.folders_order.includes(o.id)||(r.folders_order.push(o.id),r.folders.push(o)))})):(0,Ce.produce)(e,(e=>{const a=e.data.find((e=>e.id===t));if(!a)return;const s=at(r,a.folders);s&&(s.folders_order.includes(o.id)||(s.folders_order.push(o.id),s.folders.push(o)))})):e})})(t.workspaceId,t.collectionId,t.parentFolderIds,r)}}),dt=()=>(0,O.useMutation)({mutationFn:({folderId:e,signal:t})=>(async({folderId:e,signal:t})=>await a.postmanGateway.delete({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,signal:t}))({folderId:e,signal:t}),onSuccess:(e,t)=>{var r,o,a,s;r=t.workspaceId,o=t.collectionId,a=t.parentFolderIds,s=t.folderId,r&&(0,O.updateCache)({key:ne({workspaceId:r}).queryKey,updater:e=>e?0===a.length?(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));t&&(t.folders_order=t.folders_order.filter((e=>e!==s)),t.folders=t.folders.filter((e=>e.id!==s)))})):(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));if(!t)return;const r=at(a,t.folders);r&&(r.folders_order=r.folders_order.filter((e=>e!==s)),r.folders=r.folders.filter((e=>e.id!==s)))})):e}),t.onSuccess&&t.onSuccess(e)}}),lt=()=>(0,O.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r})=>(async({requestBody:e,signal:t})=>await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/transfer/folder`,body:JSON.stringify(e),signal:t}))({workspaceId:e,requestBody:t,signal:r}),onSuccess:async(e,t)=>{try{const e=await y({workspaceId:t.workspaceId,ids:[t.collectionId]});Qe(t.workspaceId,e.data[0])}catch(e){}}}),it=["requests","folders"],ct=()=>(0,O.useMutation)({mutationFn:e=>F({folderId:e.folderId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;(e=>{for(const t of it)delete e[t]})(e),r=t.workspaceId,a=t.collectionId,s=t.parentFolderIds,n=e,r&&(0,O.updateCache)({key:ne({workspaceId:r}).queryKey,updater:e=>e?0===s.length?(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===a));t&&(t.folders=t.folders.map((e=>e.id===n.id?(0,o.Z)({},e,n):e)))})):(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===a));if(!t)return;const r=at(s,t.folders);r&&(r.folders=r.folders.map((e=>e.id===n.id?(0,o.Z)({},e,n):e)))})):e})}catch(e){}var r,a,s,n}}),ut=()=>(0,O.useMutation)({mutationFn:({sourceCollectionId:e,targetCollectionId:t,targetFolderId:r,targetIndex:o,folderIds:a,signal:s})=>{const n=[];for(const[s,d]of a.entries())n.push({op:"move",from:`/collection/${e}/folder/${d}`,path:r?`/collection/${t}/folder/${r}/${o+s}/${d}`:`/collection/${t}/${o+s}/${d}`});return $({patch:n,signal:s})},onMutate:async e=>{const t=ne({workspaceId:e.workspaceId}).queryKey;let r=0,o=!1;await O.cacheClient.cancelQueries({queryKey:t});const a=O.cacheClient.getQueryData(t);return(0,O.updateCache)({key:t,updater:t=>t?(0,Ce.produce)(t,(t=>{const a=t.data.find((t=>t.id===e.sourceCollectionId)),s=e.sourceFolderId&&a?st(e.sourceFolderId,a.folders):a,n=t.data.find((t=>t.id===e.targetCollectionId)),d=e.targetFolderId&&n?st(e.targetFolderId,n.folders):n;(null==s?void 0:s.id)===(null==d?void 0:d.id)&&(o=!0);for(const[t,a]of e.folderIds.entries()){let n;if(s){const e=s.folders.findIndex((e=>e.id===a));0===t&&(r=s.folders_order.indexOf(a)),n=s.folders[e],s.folders_order=s.folders_order.filter((e=>{var t;return e!==(null==(t=n)?void 0:t.id)})),s.folders.splice(e,1)}if(d&&n){let s=e.targetIndex+t;o&&r<s&&(s-=1),d.folders.push(n),d.folders_order.splice(s,0,a)}}})):t}),{previousList:a,originalIndex:r,isMovingWithinSameParent:o}},onSuccess:(e,t,r)=>{t.onSuccess&&t.onSuccess(t.folderIds,"folder",(()=>{if(!r)return;const e=[];for(const[o,a]of t.folderIds.entries()){let s=r.originalIndex+o;r.isMovingWithinSameParent&&t.targetIndex<s&&(s+=1),e.push({op:"move",path:t.sourceFolderId?`/collection/${t.sourceCollectionId}/folder/${t.sourceFolderId}/${s}/${a}`:`/collection/${t.sourceCollectionId}/${s}/${a}`,from:`/collection/${t.targetCollectionId}/folder/${a}`})}$({patch:e}).then((()=>{(0,O.updateCache)({key:ne({workspaceId:t.workspaceId}).queryKey,updater:()=>r.previousList})})).catch((e=>{t.onError&&t.onError(t.folderIds,"folder",e)}))}))},onError:(e,t,r)=>{(0,O.updateCache)({key:ne({workspaceId:t.workspaceId}).queryKey,updater:()=>null==r?void 0:r.previousList}),t.onError&&t.onError(t.folderIds,"folder",e)}}),pt=()=>(0,O.useMutation)({mutationFn:({request:e,signal:t})=>ye({request:e,signal:t}),onSuccess:(e,t)=>{if(t.invalidateListCache)(0,O.invalidateCache)(ne({workspaceId:t.workspaceId}).queryKey);else{if(t.collectionId){const r=e.data;((e,t,r,o)=>{e&&(0,O.updateCache)({key:ne({workspaceId:e}).queryKey,updater:e=>e?0===r.length?(0,Ce.produce)(e,(e=>{const r=e.data.find((e=>e.id===t));r&&(r.order.includes(o.id)||(r.order.push(o.id),r.requests.push(o)))})):(0,Ce.produce)(e,(e=>{const a=e.data.find((e=>e.id===t));if(!a)return;const s=at(r,a.folders);s&&(s.order.includes(o.id)||(s.order.push(o.id),s.requests.push(o)))})):e})})(t.workspaceId,t.collectionId,t.parentFolderIds||[],r)}t.onSuccess&&t.onSuccess(e)}},onSettled:(e,t,r)=>{r.onSettled&&r.onSettled()},onError:(e,t)=>{t.onError&&t.onError(e)}}),ft=()=>(0,O.useMutation)({mutationFn:({requestId:e,signal:t})=>(async({requestId:e,signal:t})=>await a.postmanGateway.delete({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,signal:t}))({requestId:e,signal:t}),onSuccess:(e,t)=>{var r,o,a,s;r=t.workspaceId,o=t.collectionId,a=t.parentFolderIds,s=t.requestId,r&&(0,O.updateCache)({key:ne({workspaceId:r}).queryKey,updater:e=>e?0===a.length?(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));t&&(t.order=t.order.filter((e=>e!==s)),t.requests=t.requests.filter((e=>e.id!==s)))})):(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));if(!t)return;const r=at(a,t.folders);r&&(r.order=r.order.filter((e=>e!==s)),r.requests=r.requests.filter((e=>e.id!==s)))})):e}),t.onSuccess&&t.onSuccess(e)}}),yt=()=>(0,O.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r})=>Ie({workspaceId:e,requestBody:t,signal:r}),onSuccess:async(e,t)=>{try{const e=await y({workspaceId:t.workspaceId,ids:[t.collectionId]});Qe(t.workspaceId,e.data[0])}catch(e){}}}),It=()=>(0,O.useMutation)({mutationFn:e=>fe({requestId:e.requestId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;r=t.workspaceId,a=t.collectionId,s=t.parentFolderIds,n=e,r&&(0,O.updateCache)({key:ne({workspaceId:r}).queryKey,updater:e=>e?0===s.length?(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===a));t&&(t.requests=t.requests.map((e=>e.id===n.id?(0,o.Z)({},e,n):e)))})):(0,Ce.produce)(e,(e=>{const t=e.data.find((e=>e.id===a));if(!t)return;const r=at(s,t.folders);r&&(r.requests=r.requests.map((e=>e.id===n.id?(0,o.Z)({},e,n):e)))})):e})}catch(e){}var r,a,s,n}}),wt=()=>(0,O.useMutation)({mutationFn:({sourceCollectionId:e,targetCollectionId:t,targetFolderId:r,targetIndex:o,requestIds:a,signal:s})=>{const n=[];for(const[s,d]of a.entries())n.push({op:"move",from:`/collection/${e}/request/${d}`,path:r?`/collection/${t}/folder/${r}/${o+s}/${d}`:`/collection/${t}/${o+s}/${d}`});return $({patch:n,signal:s})},onMutate:async e=>{const t=ne({workspaceId:e.workspaceId}).queryKey;let r=0,o=!1;await O.cacheClient.cancelQueries({queryKey:t});const a=O.cacheClient.getQueryData(t);return(0,O.updateCache)({key:t,updater:t=>t?(0,Ce.produce)(t,(t=>{const a=t.data.find((t=>t.id===e.sourceCollectionId)),s=e.sourceFolderId&&a?st(e.sourceFolderId,a.folders):a,n=t.data.find((t=>t.id===e.targetCollectionId)),d=e.targetFolderId&&n?st(e.targetFolderId,n.folders):n;(null==s?void 0:s.id)===(null==d?void 0:d.id)&&(o=!0);for(const[t,a]of e.requestIds.entries()){let n;if(s){const e=s.requests.findIndex((e=>e.id===a));0===t&&(r=s.order.indexOf(a)),n=s.requests[e],s.order=s.order.filter((e=>{var t;return e!==(null==(t=n)?void 0:t.id)})),s.requests.splice(e,1)}if(d&&n){let s=e.targetIndex+t;o&&r<s&&(s-=1),d.requests.push(n),d.order.splice(s,0,a)}}})):t}),{previousList:a,originalIndex:r,isMovingWithinSameParent:o}},onSuccess:(e,t,r)=>{t.onSuccess&&t.onSuccess(t.requestIds,"request",(()=>{if(!r)return;const e=[];for(const[o,a]of t.requestIds.entries()){let s=r.originalIndex+o;r.isMovingWithinSameParent&&t.targetIndex<s&&(s+=1),e.push({op:"move",path:t.sourceFolderId?`/collection/${t.sourceCollectionId}/folder/${t.sourceFolderId}/${s}/${a}`:`/collection/${t.sourceCollectionId}/${s}/${a}`,from:`/collection/${t.targetCollectionId}/request/${a}`})}$({patch:e}).then((()=>{(0,O.updateCache)({key:ne({workspaceId:t.workspaceId}).queryKey,updater:()=>r.previousList})})).catch((e=>{t.onError&&t.onError(t.requestIds,"request",e)}))}))},onError:(e,t,r)=>{(0,O.updateCache)({key:ne({workspaceId:t.workspaceId}).queryKey,updater:()=>null==r?void 0:r.previousList}),t.onError&&t.onError(t.requestIds,"request",e)}}),ht=()=>({mutationFn:T,onSuccess:e=>{e.data.id&&e.data.owner&&O.cacheClient.setQueryData([L,l(e.data.id,e.data.owner)],e)}}),bt=()=>({mutationFn:F,onSuccess:e=>{var t,r;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner&&me(l(e.data.id,e.data.owner),_(e))}}),gt=(e,t)=>{e&&(0,O.updateCache)({key:We({responseId:e}).queryKey,updater:e=>e?(0,Ce.produce)(e,(e=>{e.data.name=t.name})):e})},qt=()=>({mutationFn:le,onSuccess:e=>{var t,r;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner&&(O.cacheClient.setQueryData([U,l(e.data.id,e.data.owner)],e),gt(l(e.data.id,e.data.owner),e.data))}}),mt=()=>({mutationFn:fe,onSuccess:e=>{var t,r;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner&&O.cacheClient.setQueryData([D,l(e.data.id,e.data.owner)],e)}}),vt=async(e,t)=>{const r=await T(t);return(0,O.updateCache)({key:x({requestId:e}).queryKey,updater:e=>{if(e&&e.data)return(0,o.Z)({},e,{data:(0,o.Z)({},e.data,{collection:r.data})})}}),r},_t=(0,C.createVariableUpdatesHandler)({model:"collection",hasEditPermission:async e=>{var t,r;const o=await O.cacheClient.fetchQuery(X({collectionId:e})).catch((()=>null));return null==(t=null==o||null==(r=o[Z.UPDATE_COLLECTION])?void 0:r.allowed)||t},getValues:async(e,{requestId:t})=>{const r=await O.cacheClient.fetchQuery(x({requestId:t||""})).then((e=>e.data.collection)).catch((()=>null));return r?{id:r.id,values:null==r?void 0:r.variables}:null},setValues:async(e,t,{requestId:r})=>r&&vt(r,{collectionId:e,patch:{variables:t}})}),kt=async e=>{var t;return(0,C.getActiveSession)({model:"collection",modelId:e.id},{values:null!=(t=e.variables)?t:[]})},Ct=({responseId:e})=>(0,O.useDataFetch)(We({responseId:e})),Tt=e=>{e.workspaceId&&(0,O.updateCache)({key:ne({workspaceId:e.workspaceId}).queryKey,updater:t=>t?e.parentFolderIds&&0!==e.parentFolderIds.length?(0,Ce.produce)(t,(t=>{const r=t.data.find((t=>t.id===e.collectionId));if(!r)return;const o=at(e.parentFolderIds,r.folders);if(!o)return;const a=o.requests.find((t=>t.id===e.requestId));if(a){var s;const t=e.afterResponseId?a.responses_order.indexOf(e.afterResponseId):a.responses_order.length-1;a.responses_order.splice(null!=(s=e.addAtIndex)?s:t+1,0,e.responseId)}})):(0,Ce.produce)(t,(t=>{const r=t.data.find((t=>t.id===e.collectionId));if(!r)return;const o=r.requests.find((t=>t.id===e.requestId));if(o){var a;const t=e.afterResponseId?o.responses_order.indexOf(e.afterResponseId):o.responses_order.length-1;o.responses_order.splice(null!=(a=e.addAtIndex)?a:t+1,0,e.responseId)}})):t})},Et=()=>(0,O.useMutation)({mutationFn:e=>ue({requestBody:{ids:[e.responseId],location:{position:"after",model:"response",id:e.responseId},target:{model:"request",id:e.requestId},mode:"copy"}}),onSuccess:async(e,t)=>{Tt({collectionId:t.collectionId,afterResponseId:t.responseId,requestId:t.requestId,responseId:e.data.ids[0],workspaceId:t.workspaceId,parentFolderIds:t.parentFolderIds})}}),Rt=()=>(0,O.useMutation)({mutationFn:e=>ce({responseId:e.responseId,signal:e.signal}),onMutate:e=>({indexOfRemovedResponse:(e=>{if(e.workspaceId){let t=null;return(0,O.updateCache)({key:ne({workspaceId:e.workspaceId}).queryKey,updater:r=>r?e.parentFolderIds&&0!==e.parentFolderIds.length?(0,Ce.produce)(r,(r=>{const o=r.data.find((t=>t.id===e.collectionId));if(!o)return;const a=at(e.parentFolderIds,o.folders);if(!a)return;const s=a.requests.find((t=>t.id===e.requestId));s&&(t=s.responses_order.indexOf(e.responseId),s.responses_order=s.responses_order.filter((t=>t!==e.responseId)))})):(0,Ce.produce)(r,(r=>{const o=r.data.find((t=>t.id===e.collectionId));if(!o)return;const a=o.requests.find((t=>t.id===e.requestId));a&&(t=a.responses_order.indexOf(e.responseId),a.responses_order=a.responses_order.filter((t=>t!==e.responseId)))})):r}),t}return null})({responseId:e.responseId,requestId:e.requestId,collectionId:e.collectionId,parentFolderIds:e.parentFolderIds,workspaceId:e.workspaceId})}),onSuccess:(e,t)=>{O.cacheClient.removeQueries([{queryKey:We({responseId:t.responseId}),exact:!0}]),t.onSuccess&&t.onSuccess()},onError:(e,t,r)=>{Tt({responseId:t.responseId,requestId:t.requestId,collectionId:t.collectionId,parentFolderIds:t.parentFolderIds,workspaceId:t.workspaceId,addAtIndex:null==r?void 0:r.indexOfRemovedResponse})}}),St=async({response:e,populateRequestObject:t,signal:r})=>{if(!e)throw new Error("CollectionService~createResponse: invalid parameters");let o;return t&&(o={populateRequestObject:!0}),_(await a.postmanGateway.post({url:`${n().HTTPS_GATEWAY_PRIVATE_URL}/response/import`,query:o,body:JSON.stringify(e),signal:r}))},$t=()=>(0,O.useMutation)({mutationFn:async e=>{if(e.responsePayload)return St({response:e.responsePayload,signal:e.signal});const t={id:(0,Be.v4)(),request:e.requestId,name:e.name||"Untitled"};return St({response:t,populateRequestObject:!0,signal:e.signal})},onSuccess:(e,t)=>{if(t.collectionId&&t.workspaceId){const r=e.data;Tt({workspaceId:t.workspaceId,collectionId:t.collectionId,requestId:t.requestId,parentFolderIds:t.parentFolderIds,responseId:r.id})}t.onSuccess&&t.onSuccess(e)},onSettled:(e,t,r)=>{r.onSettled&&r.onSettled()},onError:(e,t)=>{t.onError&&t.onError(e)}}),At=()=>(0,O.useMutation)({mutationFn:e=>le(e),onMutate:e=>{const t=O.cacheClient.getQueryData(We({responseId:e.responseId}).queryKey);if(t){const r={id:t.data.id,name:t.data.name};return gt(e.responseId,{id:e.responseId,name:e.patch.name}),{reversePatch:r}}return{}},onSuccess:e=>{var t,r;if(null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner){const t=O.cacheClient.getQueryData([U,l(e.data.id,e.data.owner)]);if(t){const r=(0,Ce.produce)(t,(t=>{t.data.name=e.data.name}));O.cacheClient.setQueryData([U,l(e.data.id,e.data.owner)],r)}gt(l(e.data.id,e.data.owner),e.data)}},onError:(e,t,r)=>{null!=r&&r.reversePatch&&gt(t.responseId,r.reversePatch)}}),Ft=(e,t,r,o)=>{const a=[];let s,n;if(t&&"object"==typeof t){const{id:r,name:o}=t;r&&o&&(s={id:r,name:o,entityType:"collection",workspaceId:e},a.push(s))}if(r&&"object"==typeof r){const t=r=>{if(r){const{id:o,name:s,folder:n}=r;n&&t(n),o&&s&&a.push({id:o,name:s,entityType:"folder",workspaceId:e})}};t(r)}if(o&&"object"==typeof o){const{id:t,name:r}=o;t&&r&&(n={id:t,name:r,entityType:"request",workspaceId:e},a.push(n))}return a},Pt=()=>(0,O.useMutation)({mutationFn:({signal:e,collectionId:t,roles:r})=>S({signal:e,collectionId:t,roles:r}),onSuccess:(e,t)=>{t.onSuccess&&t.onSuccess(e)}}),Ot=!0}}]);
//# sourceMappingURL=9199.30d3042f541a9bf8.js.map