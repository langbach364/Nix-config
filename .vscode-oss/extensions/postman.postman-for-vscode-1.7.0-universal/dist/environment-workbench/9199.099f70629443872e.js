"use strict";(self.webpackChunkenvironment_workbench=self.webpackChunkenvironment_workbench||[]).push([[9199],{49199:(e,t,r)=>{r.r(t),r.d(t,{CollectionPermissionNames:()=>Q,CollectionPermissions:()=>N,ENABLE_COLLECTIONS:()=>Ft,collectionFindOneQuery:()=>D,collectionFindTagsQuery:()=>K,collectionPermissionsQuery:()=>X,collectionVariablesHandler:()=>vt,composeUID:()=>d,createCollection:()=>y,createRequest:()=>fe,decomposeUID:()=>l,deleteResponse:()=>ie,duplicateCollection:()=>T,fetchPermissions:()=>E,findOneFolder:()=>$,findOneRequest:()=>H,findParentFolderById:()=>st,folderFindOneQuery:()=>M,folderFindOneSelectCollectionQuery:()=>W,getActiveCollectionSession:()=>_t,getBreadcrumbItems:()=>At,getCollectionList:()=>f,getCollectionListQuery:()=>ae,getResponseData:()=>O,getResponseMetaData:()=>le,getUserInfo:()=>Ie,getWorkspacePermissionsQuery:()=>oe,isUID:()=>i,patchCollection:()=>S,requestFindOneQuery:()=>V,requestFindOneSelectCollectionQuery:()=>x,responseFindOneQuery:()=>Y,responseFindOneSelectCollectionQuery:()=>B,transferRequest:()=>ye,transferResponse:()=>ce,updateCollection:()=>C,updateCollectionMutation:()=>wt,updateCollectionRoles:()=>R,updateFolder:()=>A,updateFolderMutation:()=>bt,updateRequest:()=>pe,updateRequestCollection:()=>mt,updateRequestMutation:()=>qt,updateResponse:()=>de,updateResponseMutation:()=>ht,useCollectionList:()=>xe,useCollectionListRawQuery:()=>Ve,useCollectionListSubscription:()=>He,useCollectionSubscription:()=>We,useCreateNewCollection:()=>Xe,useCreateNewFolder:()=>at,useCreateRequest:()=>ut,useCreateResponse:()=>St,useDeleteCollection:()=>Ze,useDeleteFolder:()=>nt,useDeleteRequest:()=>pt,useDeleteResponse:()=>Et,useDuplicateCollection:()=>ze,useDuplicateFolder:()=>dt,useDuplicateRequest:()=>ft,useDuplicateResponse:()=>Tt,useMoveFolder:()=>ct,useMoveRequest:()=>It,useResponseMeta:()=>kt,useResponseMetaUpdateMutation:()=>$t,useUpdateCollectionRoles:()=>Ot,useUpdateFolderInList:()=>it,useUpdateRequestInList:()=>yt,useUpdateUpdateCollectionInList:()=>tt,useWorkspacePermissions:()=>rt});var o=r(45860),s=r(26663),a=r.n(s);const n="-",d=(e,t)=>{const r=e.split(n);return!r||!t||r.length>=6?e:`${t}${n}${e}`},l=e=>{const t="string"==typeof e&&e.split(n);return!t||t.length<6?{id:e}:{owner:t.shift(),id:t.join(n)}},i=e=>{const t=e.split(n);return!!(Array.isArray(t)&&t.length>=6)},c=(e,t)=>{const r=e.responses_order.map((e=>i(e)?e:d(e,t)));return Object.assign({},e,{responses_order:r})},u=(e,t)=>{const r=e.folders_order.map((e=>i(e)?e:d(e,t))),o=e.order.map((e=>i(e)?e:d(e,t))),s=e.folders.map((e=>u(e,t))),a=e.requests.map((e=>c(e,t)));return Object.assign({},e,{folders:s,requests:a,folders_order:r,order:o})},p=(e,t)=>{const r=e.folders_order.map((e=>i(e)?e:d(e,t))),o=e.order.map((e=>i(e)?e:d(e,t))),s=e.folders.map((e=>u(e,t))),a=e.requests.map((e=>c(e,t)));return Object.assign({},e,{folders:s,requests:a,folders_order:r,order:o})},f=async({workspaceId:e,ids:t,includeResponse:r})=>e?(e=>{const t={data:[]};if(null==e||!Array.isArray(e.data))return t;for(const r of e.data){const{owner:e}=l(r.id);e?t.data.push(p(r,e)):t.data.push(r)}return t})(await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/list/collection`,query:{workspace:e},body:JSON.stringify({ids:t,exclude:{responses:!r,flags:{isArchived:!0,isFavorite:!0}}})})):{data:[]},y=async({signal:e,workspaceId:t,requestBody:r})=>await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collection/import`,query:{workspace:t},body:JSON.stringify(r),signal:e});function I(e){return e&&"object"==typeof e&&(e.id&&(e.id=d(e.id,e.owner)),e.request&&"string"==typeof e.request&&(e.request=d(e.request,e.owner))),e}function w(e){if(e&&"object"==typeof e&&(e.id&&(e.id=d(e.id,e.owner)),e.collection&&"string"==typeof e.collection&&(e.collection=d(e.collection,e.owner)),e.folder&&"string"==typeof e.folder&&(e.folder=d(e.folder,e.owner)),e.responses_order&&(e.responses_order=e.responses_order.map((t=>d(t,e.owner)))),e.responses))for(const t of e.responses)I(t);return e}function b(e){if(e&&"object"==typeof e){if(e.id&&(e.id=d(e.id,e.owner)),e.folder&&"string"==typeof e.folder&&(e.folder=d(e.folder,e.owner)),e.collection&&"string"==typeof e.collection&&(e.collection=d(e.collection,e.owner)),e.folders_order&&(e.folders_order=e.folders_order.map((t=>d(t,e.owner)))),e.folders)for(const t of e.folders)b(t);if(e.order&&(e.order=e.order.map((t=>d(t,e.owner)))),e.requests)for(const t of e.requests)w(t)}return e}function g(e){if(e&&"object"==typeof e){if(e.id&&(e.id=d(e.id,e.owner)),e.folders_order&&(e.folders_order=e.folders_order.map((t=>d(t,e.owner)))),e.folders)for(const t of e.folders)b(t);if(e.order&&(e.order=e.order.map((t=>d(t,e.owner)))),e.requests)for(const t of e.requests)w(t);e.variables&&(e.variables=h(e.variables))}return e}function h(e){return null==e?void 0:e.map((e=>e.disabled?Object.assign({},e,{enabled:!1}):Object.assign({},e,{enabled:!0})))}function q(e){return g(e.data),e}function m(e,t){return e&&e.folder&&m(e.folder,t),e.id&&t&&(e.id=d(e.id,t)),e}function v(e){var t,r,o,s,a,n,l,i,c,u,p,f,y,I,w,b,g,q;return null!=e&&null!=(t=e.data)&&t.collection&&"string"==typeof e.data.collection&&null!=e&&null!=(r=e.data)&&r.owner&&(e.data.collection=d(e.data.collection,e.data.owner)),"object"==typeof e.data.collection&&null!=e&&null!=(o=e.data)&&o.owner&&e.data.collection.id&&(e.data.collection.id=d(e.data.collection.id,e.data.owner)),"object"==typeof e.data.collection&&null!=e&&null!=(s=e.data)&&null!=(s=s.collection)&&s.variables&&(e.data.collection.variables=h(e.data.collection.variables)),null!=e&&null!=(a=e.data)&&a.id&&null!=e&&null!=(n=e.data)&&n.owner&&(e.data.id=d(e.data.id,e.data.owner)),null!=e&&null!=(l=e.data)&&l.folder&&"object"==typeof(null==e||null==(i=e.data)?void 0:i.folder)&&null!=e&&null!=(c=e.data)&&c.owner&&m(e.data.folder,e.data.owner),null!=e&&null!=(u=e.data)&&u.folder&&"string"==typeof(null==e||null==(p=e.data)?void 0:p.folder)&&null!=e&&null!=(f=e.data)&&f.owner&&(e.data.folder=d(e.data.folder,e.data.owner)),_(e)&&null!=e&&null!=(y=e.data)&&y.request&&"object"==typeof(null==e||null==(I=e.data)?void 0:I.request)&&null!=e&&null!=(w=e.data)&&w.owner&&(e.data.request.id=d(e.data.request.id,e.data.owner)),_(e)&&null!=e&&null!=(b=e.data)&&b.request&&"string"==typeof(null==e||null==(g=e.data)?void 0:g.request)&&null!=e&&null!=(q=e.data)&&q.owner&&(e.data.request=d(e.data.request,e.data.owner)),e}function _(e){return e&&e.data&&void 0!==e.data.request}var k=r(85692);const C=async({collectionId:e,patch:t,signal:r,options:s})=>{var n;if(!e)throw new Error("CollectionService~updateCollection: collectionId is a required parameter");(e=>{if(Array.isArray(e.variables)&&e.variables.length>0){var t;const r=null==(t=e.variables)?void 0:t.map((e=>"boolean"==typeof e.enabled?Object.assign({},e,{disabled:!e.enabled}):Object.assign({},e)));e.variables=r}})(t);const d=q(await o.postmanGateway.put({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,body:JSON.stringify(t),signal:r}));return null!=s&&s.avoidSession||null==d||null==(n=d.data)||!n.id||await(0,k.updateDependentSession)({model:"collection",modelId:d.data.id},{values:d.data.variables||[]}),d},T=async({workspaceId:e,collectionId:t,signal:r})=>await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collection/${t}/duplicate`,query:{workspace:e},headers:{"Content-type":"text/plain"},signal:r}),E=async({permissions:e,signal:t})=>function(e){const t=Object.keys(e),r={};for(const o of t)r[o.split(":")[1]]=e[o];return r}((await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",method:"POST",service:"acs",data:{body:e},signal:t})).results),R=async({signal:e,collectionId:t,roles:r})=>await o.postmanGateway.put({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collection/roles/${t}`,data:{roles:r},signal:e}),S=async({patch:e,signal:t})=>await o.postmanGateway.patch({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collection`,body:JSON.stringify(e),signal:t}),$=async({folderId:e,populate:t="parent",signal:r})=>{try{return e?v(await o.postmanGateway.get({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,query:{populate:t},signal:r})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}},A=async({folderId:e,patch:t,signal:r})=>{if(!e)throw new Error("CollectionService~updateFolder: folderId is a required parameter");return v(await o.postmanGateway.put({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,body:JSON.stringify(t),signal:r}))},O=async({responseId:e,populate:t="parent",signal:r})=>{try{return e?v(await o.postmanGateway.get({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,query:{populate:t},signal:r})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}};var F=r(97201);const P="collection-find-one",L="folder-find-one",G="response-find-one",j="request-find-one",U="collection-permissions",D=({signal:e,collectionId:t,populate:r=!1})=>({queryKey:r?[P,t,{populate:r}]:[P,t],queryFn:()=>(async({collectionId:e,signal:t,populate:r=!1})=>{var s;if(!e)return{model_id:"",meta:{},data:{}};const n=q(await o.postmanGateway.get({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,query:{populate:r},signal:t}));return null!=n&&null!=(s=n.data)&&s.variables&&await(0,k.updateDependentSession)({model:"collection",modelId:e},{values:n.data.variables}),n})({collectionId:t,signal:e,populate:r}),enabled:!!t,useErrorBoundary:!1}),K=({signal:e,collectionId:t})=>({queryKey:["collection-find-tags",t],queryFn:()=>(async({collectionId:e,signal:t})=>e?(await o.postmanGateway.get({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collections/${e}/tags?count=100`,signal:t})).tags:[])({collectionId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),M=({signal:e,folderId:t,populate:r="parent"})=>({queryKey:[L,t],queryFn:()=>$({folderId:t,populate:r,signal:e}),enabled:!!t,useErrorBoundary:!1}),W=({signal:e,folderId:t})=>Object.assign({},M({signal:e,folderId:t||""}),{enabled:!!t,select:e=>e.data.collection}),H=async({requestId:e,populate:t=!1,signal:r})=>{var s;const n=v(await o.postmanGateway.get({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,query:{populate:t},signal:r}));if("object"==typeof(null==n||null==(s=n.data)?void 0:s.collection)){const e=n.data.collection;await(0,k.updateDependentSession)({model:"collection",modelId:e.id},{values:e.variables||[]})}return n},V=({requestId:e})=>({queryKey:[j,e],queryFn:async({signal:t})=>H({requestId:e,populate:"parent",signal:t}),enabled:!!e,useErrorBoundary:!1}),x=({requestId:e})=>Object.assign({},V({requestId:null!=e?e:""}),{enabled:!!e,select:e=>e.data.collection}),Y=({signal:e,responseId:t})=>({queryKey:[G,t],queryFn:async()=>O({responseId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),B=({responseId:e})=>Object.assign({},Y({responseId:null!=e?e:""}),{enabled:!!e,select:e=>e.data.collection}),N={EDIT:"edit",DELETE:"delete"},Q={UPDATE_COLLECTION:"UPDATE_COLLECTION",DELETE_COLLECTION:"DELETE_COLLECTION"};function J(e,t){const r={};for(const o of Object.keys(Q))r[`${t}:${o}`]={entityId:e,entityType:"user",permission:o,objectType:"collection",objectId:t};return{checks:r}}const X=({signal:e,collectionId:t})=>({queryKey:[U,t],queryFn:()=>E({permissions:J(window.USER_ID,t),signal:e}),enabled:!!t,useErrorBoundary:!1}),z="ADD_COLLECTION_TO_WORKSPACE",Z="ADD_COLLECTIONRUN_TO_WORKSPACE",ee="REMOVE_HISTORY_FROM_WORKSPACE",te="workspace",re="user",oe=e=>({queryKey:["workspace",U,e],queryFn:({signal:t})=>(async({signal:e,workspaceId:t})=>{var r,s,n;let d={};const l=`workspace/${t}/${z}`,i=`workspace/${t}/${Z}`,c=`workspace/${t}/${ee}`,u={[l]:{entityId:window.USER_ID,entityType:re,objectId:t,objectType:te,permission:z},[i]:{entityId:window.USER_ID,entityType:re,objectId:t,objectType:te,permission:Z},[c]:{entityId:window.USER_ID,entityType:re,objectId:t,objectType:te,permission:ee}};try{const t=await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",service:"acs",data:{body:{checks:Object.assign({},u)}},signal:e});if(null==t||!t.results)throw new Error("Received invalid permissions");d=t.results}catch(e){return{userCanCreate:!0,userCanRunCollection:!0,userCanDeleteHistory:!1}}return{userCanCreate:null==(r=d[l])?void 0:r.allowed,userCanRunCollection:null==(s=d[i])?void 0:s.allowed,userCanDeleteHistory:null==(n=d[c])?void 0:n.allowed}})({signal:t,workspaceId:e}),enabled:!!e,useErrorBoundary:!1}),se="collection-list";function ae({workspaceId:e,useErrorBoundary:t=!1,select:r}){return{enabled:!!e,queryKey:[se,e],queryFn:async()=>f({workspaceId:e}),useErrorBoundary:t,select:r}}const ne=(e,t)=>{e&&(0,F.updateCache)({key:Y({responseId:e}).queryKey,updater:e=>{if(!e)return;const r=t;return e.data.collection&&(r.data.collection=e.data.collection),e.data.folder&&(r.data.folder=e.data.folder),e.data.request&&(r.data.request=e.data.request),r}})},de=async({responseId:e,patch:t,signal:r})=>{if(!e)throw new Error("CollectionService~updateResponse: responseId is a required parameter");const s=await o.postmanGateway.put({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,body:JSON.stringify(t),signal:r});return ne(e,s),v(s)},le=async({responseId:e,signal:t})=>{try{return e?v(await o.postmanGateway.get({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,signal:t})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}},ie=async({responseId:e,signal:t})=>await o.postmanGateway.delete({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,signal:t}),ce=async({requestBody:e,signal:t})=>await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/transfer/response`,body:JSON.stringify(e),signal:t}),ue=(e,t)=>{e&&(0,F.updateCache)({key:V({requestId:e}).queryKey,updater:e=>{if(!e)return;const r=t;return e.data.collection&&(r.data.collection=e.data.collection),e.data.folder&&(r.data.folder=e.data.folder),r}})},pe=async({requestId:e,patch:t,signal:r})=>{if(!e)throw new Error("CollectionService~updateRequest: requestId is a required parameter");const s=await o.postmanGateway.put({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,body:JSON.stringify(t),signal:r});return ue(e,s),v(s)},fe=async({request:e,signal:t})=>{if(!e)throw new Error("CollectionService~createRequest: invalid parameters");return v(await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/request/import?collection=${e.collection}`,body:JSON.stringify(e),signal:t}))},ye=async({requestBody:e,signal:t})=>await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/transfer/request`,body:JSON.stringify(e),signal:t}),Ie=async({type:e,userIds:t,populate:r,signal:s})=>{const n={type:e,ids:t};r&&(n.populate=r);const d=await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/public_profile",service:"ums",method:"post",data:{body:n},signal:s});if(!d)throw new Error("Received invalid users");return d.users};var we=r(40540);const be=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.collectionId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({collectionId:t=e.collectionId,workspaceId:r=e.workspaceId,subscribingEntity:s=null,subscriptionHandler:a}){if(""===t)return;if(e.observer||e.asyncObserver)return;const{asyncObserver:n,abortController:d}=(e=>{const t=new AbortController;return{asyncObserver:o.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",service:"sync",url:`/collection/${e}/subscribe`,data:{}},subscriptionEvents:["update","update_roles","destroy","import","create"],responseFilter:e=>{var t;return null==e||null==(t=e.body)?void 0:t.model_id},broadcastFilter:e=>{var t;return l(null==e||null==(t=e.meta)||null==(t=t.timeline)?void 0:t.model_id).id},unsubscribeRequest:{method:"delete",service:"sync",url:`/collection/${e}/unsubscribe`,data:{}}}),abortController:t}})(t);e.abortController=d,e.asyncObserver=n,e.observer=await n,e.abortController=null,e.observer.subscribe({next:e=>{a(e,{collectionId:t,workspaceId:r,subscribingEntity:s})},complete:()=>{e.unsubscribe()},error:async function(r){e.cleanup(),await e.subscribe({subscriptionHandler:a,collectionId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}};var ge=r(14350);const he=async(e,t,r)=>{switch(t.meta.action){case"update":{var o;"folder"===(null==r?void 0:r.type)&&(0,F.invalidateCache)([L,null==r?void 0:r.id]),"request"===(null==r?void 0:r.type)&&(0,F.invalidateCache)([j,null==r?void 0:r.id]),"response"===(null==r?void 0:r.type)&&(0,F.invalidateCache)([G,null==r?void 0:r.id]);const s=q(t);((e,t)=>{e&&(0,F.updateCache)({key:D({collectionId:e}).queryKey,updater:e=>{if(e)return t}})})(e,s),null!=s&&null!=(o=s.data)&&o.id&&await(0,k.updateDependentSession)({model:"collection",modelId:s.data.id},{values:s.data.variables||[]});break}}},qe=(e,t)=>{e&&(0,F.updateCache)({key:M({folderId:e}).queryKey,updater:e=>{if(!e)return;const r=t;return e.data.collection&&(r.data.collection=e.data.collection),e.data.folder&&(r.data.folder=e.data.folder),r}})};var me=r(19578);const ve=(e,t,r)=>{var o;const s=`${null==e||null==(o=e.data)?void 0:o.owner}-${null==e?void 0:e.model_id}`,a=(0,me.getTabManager)();switch(e.meta.action){case"update":"folder"===(null==r?void 0:r.type)&&(null==r?void 0:r.id)!==s&&(0,F.invalidateCache)([L,null==r?void 0:r.id]),"request"===(null==r?void 0:r.type)&&(0,F.invalidateCache)([j,null==r?void 0:r.id]),"response"===(null==r?void 0:r.type)&&(0,F.invalidateCache)([G,null==r?void 0:r.id]),qe(s,v(e));break;case"destroy":a.closeTabByRoute(`/workspace/${t}/folder/${s}`)}},_e=(e,t,r)=>{var o;const s=`${null==e||null==(o=e.data)?void 0:o.owner}-${null==e?void 0:e.model_id}`,a=(0,me.getTabManager)();switch(e.meta.action){case"update":"response"===(null==r?void 0:r.type)&&(0,F.invalidateCache)([G,null==r?void 0:r.id]),ue(s,v(e));break;case"destroy":a.closeTabByRoute(`/workspace/${t}/request/${s}`)}};var ke=r(3860),Ce=r.n(ke);function Te(e,t){return e.folders.find((e=>e.id===t))||null}function Ee(e,t){return e.requests.find((e=>e.id===t))||null}function Re(e,t){if(e.folders_order.includes(t))return e;for(const r of e.folders){const e=Re(r,t);if(e)return e}return null}function Se(e,t){if(e.folders_order.includes(t))return e;for(const r of e.folders){const e=Re(r,t);if(e)return e}return null}function $e(e,t){if(e.order.includes(t))return e;for(const r of e.folders){const e=$e(r,t);if(e)return e}return null}function Ae(e,t){if(e.order.includes(t))return e;for(const r of e.folders){const e=$e(r,t);if(e)return e}return null}function Oe(e,...t){const r={};for(const o of Object.keys(e))t.includes(o)||(r[o]=e[o]);return r}function Fe(e,t,r){e&&"object"==typeof e&&(e.owner=r)}function Pe(e,t,r){if(e&&"object"==typeof e&&(e.owner=r,e.collection&&"string"==typeof e.collection&&(e.collection=t),e.responses_order&&(e.responses_order=e.responses_order.map((e=>`${r}-${l(e).id}`))),e.responses))for(const t of e.responses)Fe(t,0,r)}function Le(e,t,r){if(e&&"object"==typeof e){if(e.owner=r,e.folders_order&&(e.folders_order=e.folders_order.map((e=>`${r}-${l(e).id}`))),e.folders)for(const o of e.folders)Le(o,t,r);if(e.order&&(e.order=e.order.map((e=>`${r}-${l(e).id}`))),e.requests)for(const o of e.requests)Pe(o,t,r)}}function Ge(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Te(e.data,t.data.folder)),r&&(Le(t.data,e.data.id,e.data.owner),r.folders_order.push(t.data.id),e.data.folders.push(t.data)),e}const je=(e,t)=>{e&&(0,F.updateCache)({key:D({collectionId:e,populate:!0}).queryKey,updater:e=>{if(e)return Ce()(e,(e=>{switch(t.type){case"collection-update":return function(e,t){const r=Oe(t.data,"folders","requests");return Object.assign(e.data,r),e}(e,t);case"collection-destroy":return e;case"folder-import":return function(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Te(e.data,t.data.folder)),r&&(r.folders_order||(r.folders_order=[]),r.folders_order.push(t.data.id),e.data.folders||(e.data.folders=[]),e.data.folders.push(t.data)),e}(e,t);case"folder-destroy":return function(e,t){const r=Se(e.data,t.data.id);return r&&(r.folders_order=r.folders_order.filter((e=>e!==t.data.id)),e.data.folders=e.data.folders.filter((e=>e.id!==t.data.id))),e}(e,t);case"folder-update":return function(e,t){const r=Te(e.data,t.data.id);return r?(r.collection!==t.data.collection||r.folder!==t.data.folder||Object.assign(r,t.data),e):e}(e,t);case"folder-remove":return function(e,t){const r=Se(e.data,t.data.id);return r&&(r.folders_order=r.folders_order.filter((e=>e!==t.data.id)),e.data.folders=e.data.folders.filter((e=>e.id!==t.data.id))),e}(e,t);case"folder-add":return Ge(e,t);case"request-import":return function(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Te(e.data,t.data.folder)),r&&(r.order||(r.order=[]),r.order.push(t.data.id),e.data.requests||(e.data.requests=[]),e.data.requests.push(t.data)),e}(e,t);case"request-destroy":return function(e,t){const r=Ae(e.data,t.data.id);return r&&(r.order=r.order.filter((e=>e!==t.data.id)),e.data.requests=e.data.requests.filter((e=>e.id!==t.data.id))),e}(e,t);case"request-update":return function(e,t){const r=Ee(e.data,t.data.id);if(!r)return e;const o=Oe(t.data,"responses");return r.collection!==t.data.collection||r.folder!==t.data.folder||Object.assign(r,o),e}(e,t);case"request-remove":return function(e,t){const r=Ae(e.data,t.data.id);return r&&(r.order=r.order.filter((e=>e!==t.data.id)),e.data.requests=e.data.requests.filter((e=>e.id!==t.data.id))),e}(e,t);case"request-add":return function(e,t){let r=e.data;return t.data.folder&&"string"==typeof t.data.folder&&(r=Te(e.data,t.data.folder)),r&&(Pe(t.data,e.data.id,e.data.owner),r.order||(r.order=[]),r.order.push(t.data.id),e.data.requests||(e.data.requests=[]),e.data.requests.push(t.data)),e}(e,t);case"response-import":return function(e,t){if(!t.data.request||"string"!=typeof t.data.request)return e;const r=Ee(e.data,t.data.request);return r&&(r.responses_order||(r.responses_order=[]),r.responses_order.push(t.data.id),r.responses||(r.responses=[]),r.responses.push(t.data)),e}(e,t);case"response-destroy":return function(e,t){const r=function(e,t){for(const r of e.requests)if(r.responses.some((e=>e.id===t)))return r;return null}(e.data,t.data.id);return r&&(r.responses_order=r.responses_order.filter((e=>e!==t.data.id)),r.responses=r.responses.filter((e=>e.id!==t.data.id))),e}(e,t);case"response-update":return function(e,t){const r=function(e,t){for(const r of e.requests){const e=r.responses.find((e=>e.id===t));if(e)return e}return null}(e.data,t.data.id);return r&&Object.assign(r,t.data),e}(e,t)}return e}))}})},Ue=(e,{collectionId:t,workspaceId:r,subscribingEntity:o})=>{switch(e.meta.model){case"collection":"update_roles"===e.meta.action&&((0,F.invalidateCache)([U,t]),(0,F.invalidateCache)([ge.ACCESS_CONTROL_QUERY_KEY_PREFIX,ge.ALL_ROLES,"collection",t])),o?he(t,e,o):he(t,e);break;case"folder":o?ve(e,r,o):ve(e,r);break;case"request":o?_e(e,r,o):_e(e,r);break;case"response":((e,t)=>{var r;const o=null==e||null==(r=e.data)?void 0:r.owner,s=(0,me.getTabManager)(),a=`${o}-${null==e?void 0:e.model_id}`;switch(e.meta.action){case"update":ne(a,v(e));break;case"destroy":s.closeTabByRoute(`/workspace/${t}/example/${a}`)}})(e,r)}(async e=>{var t;const r=null==(t=e.meta)||null==(t=t.timeline)?void 0:t.model_id;if(F.cacheClient.getQueryData(D({collectionId:r,populate:!0}).queryKey))if("destroy"!==e.meta.action)switch(e.meta.model){case"collection":je(r,{type:`collection-${e.meta.action}`,data:g(e.data)});break;case"folder":je(r,{type:`folder-${e.meta.action}`,data:b(e.data)});break;case"request":je(r,{type:`request-${e.meta.action}`,data:w(e.data)});break;case"response":if("create"===e.meta.action){je(r,{type:"response-import",data:I(e.data)});break}je(r,{type:"response-update",data:I(e.data)})}else je(r,{type:`${e.meta.model}-destroy`,data:{id:d(e.data.id,e.data.owner)}})})(e)},De=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:t=e.workspaceId,subscriptionHandler:r}){if(""===t)return;if(e.workspaceId!==t&&e.changeWorkspace(t),e.observer||e.asyncObserver)return;const{asyncObserver:s,abortController:a}=(e=>{const t=new AbortController;return{asyncObserver:o.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",service:"sync",url:`/list/collection?workspace=${e}&subscribe=true`,data:{}},subscriptionEvents:["broadcast"],responseFilter:e=>{var t;return null==e||null==(t=e.body)||null==(t=t.subscription)?void 0:t.id},broadcastFilter:e=>{var t;return null==e||null==(t=e.data)||null==(t=t.subscription)?void 0:t.id},unsubscribeRequest:{method:"delete",service:"sync",url:`/list/collection/subscribe?workspace=${e}`,data:{}}}),abortController:t}})(t);e.abortController=a,e.asyncObserver=s,e.observer=await s,e.abortController=null,(0,F.invalidateCache)([se,t]),e.observer.subscribe({next:e=>{r(e,{workspaceId:t})},complete:()=>{e.unsubscribe()},error:async function(o){e.cleanup(),await e.subscribe({subscriptionHandler:r,workspaceId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}},Ke=({signal:e,responseId:t})=>({queryKey:["response-meta",t],queryFn:async()=>le({responseId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),Me=(e,{workspaceId:t})=>{if("broadcast"===e.meta.action&&"workspace"===e.meta.model){const r=[],o=[];"response"===e.meta.entity&&e.meta.entity_id&&(0,F.invalidateCache)(Ke({responseId:e.meta.entity_id}).queryKey);for(const t of e.data.data)"create"===t.action||"update"===t.action?r.push(t.id):"delete"===t.action&&o.push(t.id);r.length>0&&((e,t)=>{(async(e,t)=>{if(e&&t.length>0)try{const r=(await f({workspaceId:e,ids:t})).data,o=r.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);(0,F.updateCache)({key:ae({workspaceId:e}).queryKey,updater:e=>{if(!e)return e;const t=e.data.filter((e=>o.has(e.id))),s=new Set(t.map((e=>e.id))),a=new Set([...o.keys()].filter((e=>!s.has(e))));return(0,ke.produce)(e,(e=>{const t=e.data.map((e=>s.has(e.id)&&o.get(e.id)||e)),n=r.filter((e=>a.has(e.id)));e.data=[...t,...n]}))}})}catch(e){}})(e,t)})(t,r),o.length>0&&((e,t)=>{(async(e,t)=>{e&&t.length>0&&(0,F.updateCache)({key:ae({workspaceId:e}).queryKey,updater:e=>e?{data:e.data.filter((e=>!t.includes(e.id)))}:e})})(e,t)})(t,o)}},We=({collectionId:e,workspaceId:t,subscribingEntity:r=null})=>{(0,we.useEffect)((()=>{if(e)return be.subscribe({collectionId:e,workspaceId:t,subscribingEntity:r,subscriptionHandler:Ue}),()=>{be.unsubscribe()}}),[e])},He=({workspaceId:e})=>{(0,we.useEffect)((()=>{if(e)return De.subscribe({workspaceId:e,subscriptionHandler:Me}),()=>{De.unsubscribe()}}),[e])};function Ve({workspaceId:e,select:t}){return(0,F.useDataFetch)(ae({workspaceId:e,select:t}))}const xe=({workspaceId:e})=>{const{data:t,isError:r,refetch:o,isRefetching:s}=Ve({workspaceId:e});return{data:t?t.data:null,refetch:o,hasPageError:r,isRefetching:s}};var Ye=r(60398);const Be=(e,t)=>{e&&(0,F.updateCache)({key:ae({workspaceId:e}).queryKey,updater:e=>e?e.data.find((e=>e.id===t.id))?void 0:Object.assign({},e,{data:[...e.data,t]}):e})},Ne=(e,t)=>{e&&(0,F.updateCache)({key:ae({workspaceId:e}).queryKey,updater:e=>e?(0,ke.produce)(e,(e=>{const r=e.data.map((e=>e.id===t.id?Object.assign({},e,t):e));e.data=r})):e})},Qe={permissions:{userCanDelete:!0,userCanUpdate:!0}},Je={id:(0,Ye.v4)(),name:"New Collection",order:[],folders_order:[],folders:[],requests:[]},Xe=()=>(0,F.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r})=>y({workspaceId:e,requestBody:t,signal:r}),onSuccess:(e,t)=>{const r=Object.assign({},Je,e.data,{id:d(e.data.id,e.data.owner)}),o=Object.assign({},r,{attributes:Qe});Be(t.workspaceId,o)}}),ze=()=>(0,F.useMutation)({mutationFn:e=>T({workspaceId:e.workspaceId,collectionId:e.collectionId,signal:e.signal}),onSuccess:async(e,t)=>{try{const r=await f({workspaceId:t.workspaceId,ids:[d(e.data.id,e.data.owner)]});Be(t.workspaceId,r.data[0])}catch(e){}}}),Ze=()=>(0,F.useMutation)({mutationFn:e=>(async({collectionId:e,signal:t})=>{const r=await o.postmanGateway.delete({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,signal:t});return await(0,k.deleteDependentSession)({model:"collection",modelId:e}),r})({collectionId:e.collectionId,signal:e.signal}),onSuccess:(e,t)=>{var r,o;r=t.workspaceId,o=t.collectionId,r&&(0,F.updateCache)({key:ae({workspaceId:r}).queryKey,updater:e=>{if(!e)return e;const t=e.data.filter((e=>e.id!==o));return Object.assign({},e,{data:[...t]})}}),t.onSuccess&&t.onSuccess(e)}}),et=["requests","folders"],tt=()=>(0,F.useMutation)({mutationFn:e=>C({collectionId:e.collectionId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;(e=>{for(const t of et)delete e[t]})(e),Ne(t.workspaceId,e)}catch(e){}}}),rt=e=>{const{data:t}=(0,F.useDataFetch)(oe(e));return null!=t?t:{userCanCreate:!0,userCanRunCollection:!1,userCanDeleteHistory:!1}},ot=(e,t)=>{const r=e[0],o=e.slice(1);if(!r)return;const s=t.find((e=>e.id===r));return s?o.length>0?ot(o,s.folders):s:void 0},st=(e,t)=>{let r;for(const o of t){if(o.id===e){r=o;break}!r&&o.folders.length>0&&(r=st(e,o.folders))}return r},at=()=>(0,F.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r,collectionId:s})=>(async({requestBody:e,collectionId:t,signal:r})=>v(await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/folder/import`,query:{collection:t},body:JSON.stringify(e),signal:r})))({workspaceId:e,requestBody:t,signal:r,collectionId:s}),onSuccess:(e,t)=>{const r=e.data;((e,t,r,o)=>{e&&(0,F.updateCache)({key:ae({workspaceId:e}).queryKey,updater:e=>e?0===r.length?(0,ke.produce)(e,(e=>{const r=e.data.find((e=>e.id===t));r&&(r.folders_order.includes(o.id)||(r.folders_order.push(o.id),r.folders.push(o)))})):(0,ke.produce)(e,(e=>{const s=e.data.find((e=>e.id===t));if(!s)return;const a=ot(r,s.folders);a&&(a.folders_order.includes(o.id)||(a.folders_order.push(o.id),a.folders.push(o)))})):e})})(t.workspaceId,t.collectionId,t.parentFolderIds,r)}}),nt=()=>(0,F.useMutation)({mutationFn:({folderId:e,signal:t})=>(async({folderId:e,signal:t})=>await o.postmanGateway.delete({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,signal:t}))({folderId:e,signal:t}),onSuccess:(e,t)=>{var r,o,s,a;r=t.workspaceId,o=t.collectionId,s=t.parentFolderIds,a=t.folderId,r&&(0,F.updateCache)({key:ae({workspaceId:r}).queryKey,updater:e=>e?0===s.length?(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));t&&(t.folders_order=t.folders_order.filter((e=>e!==a)),t.folders=t.folders.filter((e=>e.id!==a)))})):(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));if(!t)return;const r=ot(s,t.folders);r&&(r.folders_order=r.folders_order.filter((e=>e!==a)),r.folders=r.folders.filter((e=>e.id!==a)))})):e}),t.onSuccess&&t.onSuccess(e)}}),dt=()=>(0,F.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r})=>(async({requestBody:e,signal:t})=>await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/transfer/folder`,body:JSON.stringify(e),signal:t}))({workspaceId:e,requestBody:t,signal:r}),onSuccess:async(e,t)=>{try{const e=await f({workspaceId:t.workspaceId,ids:[t.collectionId]});Ne(t.workspaceId,e.data[0])}catch(e){}}}),lt=["requests","folders"],it=()=>(0,F.useMutation)({mutationFn:e=>A({folderId:e.folderId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;(e=>{for(const t of lt)delete e[t]})(e),r=t.workspaceId,o=t.collectionId,s=t.parentFolderIds,a=e,r&&(0,F.updateCache)({key:ae({workspaceId:r}).queryKey,updater:e=>e?0===s.length?(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));t&&(t.folders=t.folders.map((e=>e.id===a.id?Object.assign({},e,a):e)))})):(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));if(!t)return;const r=ot(s,t.folders);r&&(r.folders=r.folders.map((e=>e.id===a.id?Object.assign({},e,a):e)))})):e})}catch(e){}var r,o,s,a}}),ct=()=>(0,F.useMutation)({mutationFn:({sourceCollectionId:e,targetCollectionId:t,targetFolderId:r,targetIndex:o,folderIds:s,signal:a})=>{const n=[];for(const[a,d]of s.entries())n.push({op:"move",from:`/collection/${e}/folder/${d}`,path:r?`/collection/${t}/folder/${r}/${o+a}/${d}`:`/collection/${t}/${o+a}/${d}`});return S({patch:n,signal:a})},onMutate:async e=>{const t=ae({workspaceId:e.workspaceId}).queryKey;let r=0,o=!1;await F.cacheClient.cancelQueries({queryKey:t});const s=F.cacheClient.getQueryData(t);return(0,F.updateCache)({key:t,updater:t=>t?(0,ke.produce)(t,(t=>{const s=t.data.find((t=>t.id===e.sourceCollectionId)),a=e.sourceFolderId&&s?st(e.sourceFolderId,s.folders):s,n=t.data.find((t=>t.id===e.targetCollectionId)),d=e.targetFolderId&&n?st(e.targetFolderId,n.folders):n;(null==a?void 0:a.id)===(null==d?void 0:d.id)&&(o=!0);for(const[t,s]of e.folderIds.entries()){let n;if(a){const e=a.folders.findIndex((e=>e.id===s));0===t&&(r=a.folders_order.indexOf(s)),n=a.folders[e],a.folders_order=a.folders_order.filter((e=>{var t;return e!==(null==(t=n)?void 0:t.id)})),a.folders.splice(e,1)}if(d&&n){let a=e.targetIndex+t;o&&r<a&&(a-=1),d.folders.push(n),d.folders_order.splice(a,0,s)}}})):t}),{previousList:s,originalIndex:r,isMovingWithinSameParent:o}},onSuccess:(e,t,r)=>{t.onSuccess&&t.onSuccess(t.folderIds,"folder",(()=>{if(!r)return;const e=[];for(const[o,s]of t.folderIds.entries()){let a=r.originalIndex+o;r.isMovingWithinSameParent&&t.targetIndex<a&&(a+=1),e.push({op:"move",path:t.sourceFolderId?`/collection/${t.sourceCollectionId}/folder/${t.sourceFolderId}/${a}/${s}`:`/collection/${t.sourceCollectionId}/${a}/${s}`,from:`/collection/${t.targetCollectionId}/folder/${s}`})}S({patch:e}).then((()=>{(0,F.updateCache)({key:ae({workspaceId:t.workspaceId}).queryKey,updater:()=>r.previousList})})).catch((e=>{t.onError&&t.onError(t.folderIds,"folder",e)}))}))},onError:(e,t,r)=>{(0,F.updateCache)({key:ae({workspaceId:t.workspaceId}).queryKey,updater:()=>null==r?void 0:r.previousList}),t.onError&&t.onError(t.folderIds,"folder",e)}}),ut=()=>(0,F.useMutation)({mutationFn:({request:e,signal:t})=>fe({request:e,signal:t}),onSuccess:(e,t)=>{if(t.invalidateListCache)(0,F.invalidateCache)(ae({workspaceId:t.workspaceId}).queryKey);else{if(t.collectionId){const r=e.data;((e,t,r,o)=>{e&&(0,F.updateCache)({key:ae({workspaceId:e}).queryKey,updater:e=>e?0===r.length?(0,ke.produce)(e,(e=>{const r=e.data.find((e=>e.id===t));r&&(r.order.includes(o.id)||(r.order.push(o.id),r.requests.push(o)))})):(0,ke.produce)(e,(e=>{const s=e.data.find((e=>e.id===t));if(!s)return;const a=ot(r,s.folders);a&&(a.order.includes(o.id)||(a.order.push(o.id),a.requests.push(o)))})):e})})(t.workspaceId,t.collectionId,t.parentFolderIds||[],r)}t.onSuccess&&t.onSuccess(e)}},onSettled:(e,t,r)=>{r.onSettled&&r.onSettled()},onError:(e,t)=>{t.onError&&t.onError(e)}}),pt=()=>(0,F.useMutation)({mutationFn:({requestId:e,signal:t})=>(async({requestId:e,signal:t})=>await o.postmanGateway.delete({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,signal:t}))({requestId:e,signal:t}),onSuccess:(e,t)=>{var r,o,s,a;r=t.workspaceId,o=t.collectionId,s=t.parentFolderIds,a=t.requestId,r&&(0,F.updateCache)({key:ae({workspaceId:r}).queryKey,updater:e=>e?0===s.length?(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));t&&(t.order=t.order.filter((e=>e!==a)),t.requests=t.requests.filter((e=>e.id!==a)))})):(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));if(!t)return;const r=ot(s,t.folders);r&&(r.order=r.order.filter((e=>e!==a)),r.requests=r.requests.filter((e=>e.id!==a)))})):e}),t.onSuccess&&t.onSuccess(e)}}),ft=()=>(0,F.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:r})=>ye({workspaceId:e,requestBody:t,signal:r}),onSuccess:async(e,t)=>{try{const e=await f({workspaceId:t.workspaceId,ids:[t.collectionId]});Ne(t.workspaceId,e.data[0])}catch(e){}}}),yt=()=>(0,F.useMutation)({mutationFn:e=>pe({requestId:e.requestId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;r=t.workspaceId,o=t.collectionId,s=t.parentFolderIds,a=e,r&&(0,F.updateCache)({key:ae({workspaceId:r}).queryKey,updater:e=>e?0===s.length?(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));t&&(t.requests=t.requests.map((e=>e.id===a.id?Object.assign({},e,a):e)))})):(0,ke.produce)(e,(e=>{const t=e.data.find((e=>e.id===o));if(!t)return;const r=ot(s,t.folders);r&&(r.requests=r.requests.map((e=>e.id===a.id?Object.assign({},e,a):e)))})):e})}catch(e){}var r,o,s,a}}),It=()=>(0,F.useMutation)({mutationFn:({sourceCollectionId:e,targetCollectionId:t,targetFolderId:r,targetIndex:o,requestIds:s,signal:a})=>{const n=[];for(const[a,d]of s.entries())n.push({op:"move",from:`/collection/${e}/request/${d}`,path:r?`/collection/${t}/folder/${r}/${o+a}/${d}`:`/collection/${t}/${o+a}/${d}`});return S({patch:n,signal:a})},onMutate:async e=>{const t=ae({workspaceId:e.workspaceId}).queryKey;let r=0,o=!1;await F.cacheClient.cancelQueries({queryKey:t});const s=F.cacheClient.getQueryData(t);return(0,F.updateCache)({key:t,updater:t=>t?(0,ke.produce)(t,(t=>{const s=t.data.find((t=>t.id===e.sourceCollectionId)),a=e.sourceFolderId&&s?st(e.sourceFolderId,s.folders):s,n=t.data.find((t=>t.id===e.targetCollectionId)),d=e.targetFolderId&&n?st(e.targetFolderId,n.folders):n;(null==a?void 0:a.id)===(null==d?void 0:d.id)&&(o=!0);for(const[t,s]of e.requestIds.entries()){let n;if(a){const e=a.requests.findIndex((e=>e.id===s));0===t&&(r=a.order.indexOf(s)),n=a.requests[e],a.order=a.order.filter((e=>{var t;return e!==(null==(t=n)?void 0:t.id)})),a.requests.splice(e,1)}if(d&&n){let a=e.targetIndex+t;o&&r<a&&(a-=1),d.requests.push(n),d.order.splice(a,0,s)}}})):t}),{previousList:s,originalIndex:r,isMovingWithinSameParent:o}},onSuccess:(e,t,r)=>{t.onSuccess&&t.onSuccess(t.requestIds,"request",(()=>{if(!r)return;const e=[];for(const[o,s]of t.requestIds.entries()){let a=r.originalIndex+o;r.isMovingWithinSameParent&&t.targetIndex<a&&(a+=1),e.push({op:"move",path:t.sourceFolderId?`/collection/${t.sourceCollectionId}/folder/${t.sourceFolderId}/${a}/${s}`:`/collection/${t.sourceCollectionId}/${a}/${s}`,from:`/collection/${t.targetCollectionId}/request/${s}`})}S({patch:e}).then((()=>{(0,F.updateCache)({key:ae({workspaceId:t.workspaceId}).queryKey,updater:()=>r.previousList})})).catch((e=>{t.onError&&t.onError(t.requestIds,"request",e)}))}))},onError:(e,t,r)=>{(0,F.updateCache)({key:ae({workspaceId:t.workspaceId}).queryKey,updater:()=>null==r?void 0:r.previousList}),t.onError&&t.onError(t.requestIds,"request",e)}}),wt=()=>({mutationFn:C,onSuccess:e=>{e.data.id&&e.data.owner&&F.cacheClient.setQueryData([P,d(e.data.id,e.data.owner)],e)}}),bt=()=>({mutationFn:A,onSuccess:e=>{var t,r;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner&&qe(d(e.data.id,e.data.owner),v(e))}}),gt=(e,t)=>{e&&(0,F.updateCache)({key:Ke({responseId:e}).queryKey,updater:e=>e?(0,ke.produce)(e,(e=>{e.data.name=t.name})):e})},ht=()=>({mutationFn:de,onSuccess:e=>{var t,r;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner&&(F.cacheClient.setQueryData([G,d(e.data.id,e.data.owner)],e),gt(d(e.data.id,e.data.owner),e.data))}}),qt=()=>({mutationFn:pe,onSuccess:e=>{var t,r;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner&&F.cacheClient.setQueryData([j,d(e.data.id,e.data.owner)],e)}}),mt=async(e,t)=>{const r=await C(t);return(0,F.updateCache)({key:V({requestId:e}).queryKey,updater:e=>{if(e&&e.data)return Object.assign({},e,{data:Object.assign({},e.data,{collection:r.data})})}}),r},vt=(0,k.createVariableUpdatesHandler)({model:"collection",hasEditPermission:async e=>{var t,r;const o=await F.cacheClient.fetchQuery(X({collectionId:e})).catch((()=>null));return null==(t=null==o||null==(r=o[Q.UPDATE_COLLECTION])?void 0:r.allowed)||t},getValues:async(e,{requestId:t})=>{const r=await F.cacheClient.fetchQuery(V({requestId:t||""})).then((e=>e.data.collection)).catch((()=>null));return r?{id:r.id,values:null==r?void 0:r.variables}:null},setValues:async(e,t,{requestId:r})=>r&&mt(r,{collectionId:e,patch:{variables:t}})}),_t=async e=>{var t;return(0,k.getActiveSession)({model:"collection",modelId:e.id},{values:null!=(t=e.variables)?t:[]})},kt=({responseId:e})=>(0,F.useDataFetch)(Ke({responseId:e})),Ct=e=>{e.workspaceId&&(0,F.updateCache)({key:ae({workspaceId:e.workspaceId}).queryKey,updater:t=>t?e.parentFolderIds&&0!==e.parentFolderIds.length?(0,ke.produce)(t,(t=>{const r=t.data.find((t=>t.id===e.collectionId));if(!r)return;const o=ot(e.parentFolderIds,r.folders);if(!o)return;const s=o.requests.find((t=>t.id===e.requestId));if(s){var a;const t=e.afterResponseId?s.responses_order.indexOf(e.afterResponseId):s.responses_order.length-1;s.responses_order.splice(null!=(a=e.addAtIndex)?a:t+1,0,e.responseId)}})):(0,ke.produce)(t,(t=>{const r=t.data.find((t=>t.id===e.collectionId));if(!r)return;const o=r.requests.find((t=>t.id===e.requestId));if(o){var s;const t=e.afterResponseId?o.responses_order.indexOf(e.afterResponseId):o.responses_order.length-1;o.responses_order.splice(null!=(s=e.addAtIndex)?s:t+1,0,e.responseId)}})):t})},Tt=()=>(0,F.useMutation)({mutationFn:e=>ce({requestBody:{ids:[e.responseId],location:{position:"after",model:"response",id:e.responseId},target:{model:"request",id:e.requestId},mode:"copy"}}),onSuccess:async(e,t)=>{Ct({collectionId:t.collectionId,afterResponseId:t.responseId,requestId:t.requestId,responseId:e.data.ids[0],workspaceId:t.workspaceId,parentFolderIds:t.parentFolderIds})}}),Et=()=>(0,F.useMutation)({mutationFn:e=>ie({responseId:e.responseId,signal:e.signal}),onMutate:e=>({indexOfRemovedResponse:(e=>{if(e.workspaceId){let t=null;return(0,F.updateCache)({key:ae({workspaceId:e.workspaceId}).queryKey,updater:r=>r?e.parentFolderIds&&0!==e.parentFolderIds.length?(0,ke.produce)(r,(r=>{const o=r.data.find((t=>t.id===e.collectionId));if(!o)return;const s=ot(e.parentFolderIds,o.folders);if(!s)return;const a=s.requests.find((t=>t.id===e.requestId));a&&(t=a.responses_order.indexOf(e.responseId),a.responses_order=a.responses_order.filter((t=>t!==e.responseId)))})):(0,ke.produce)(r,(r=>{const o=r.data.find((t=>t.id===e.collectionId));if(!o)return;const s=o.requests.find((t=>t.id===e.requestId));s&&(t=s.responses_order.indexOf(e.responseId),s.responses_order=s.responses_order.filter((t=>t!==e.responseId)))})):r}),t}return null})({responseId:e.responseId,requestId:e.requestId,collectionId:e.collectionId,parentFolderIds:e.parentFolderIds,workspaceId:e.workspaceId})}),onSuccess:(e,t)=>{F.cacheClient.removeQueries([{queryKey:Ke({responseId:t.responseId}),exact:!0}]),t.onSuccess&&t.onSuccess()},onError:(e,t,r)=>{Ct({responseId:t.responseId,requestId:t.requestId,collectionId:t.collectionId,parentFolderIds:t.parentFolderIds,workspaceId:t.workspaceId,addAtIndex:null==r?void 0:r.indexOfRemovedResponse})}}),Rt=async({response:e,populateRequestObject:t,signal:r})=>{if(!e)throw new Error("CollectionService~createResponse: invalid parameters");let s;return t&&(s={populateRequestObject:!0}),v(await o.postmanGateway.post({url:`${a().HTTPS_GATEWAY_PRIVATE_URL}/response/import`,query:s,body:JSON.stringify(e),signal:r}))},St=()=>(0,F.useMutation)({mutationFn:async e=>{if(e.responsePayload)return Rt({response:e.responsePayload,signal:e.signal});const t={id:(0,Ye.v4)(),request:e.requestId,name:e.name||"Untitled"};return Rt({response:t,populateRequestObject:!0,signal:e.signal})},onSuccess:(e,t)=>{if(t.collectionId&&t.workspaceId){const r=e.data;Ct({workspaceId:t.workspaceId,collectionId:t.collectionId,requestId:t.requestId,parentFolderIds:t.parentFolderIds,responseId:r.id})}t.onSuccess&&t.onSuccess(e)},onSettled:(e,t,r)=>{r.onSettled&&r.onSettled()},onError:(e,t)=>{t.onError&&t.onError(e)}}),$t=()=>(0,F.useMutation)({mutationFn:e=>de(e),onMutate:e=>{const t=F.cacheClient.getQueryData(Ke({responseId:e.responseId}).queryKey);if(t){const r={id:t.data.id,name:t.data.name};return gt(e.responseId,{id:e.responseId,name:e.patch.name}),{reversePatch:r}}return{}},onSuccess:e=>{var t,r;if(null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(r=e.data)&&r.owner){const t=F.cacheClient.getQueryData([G,d(e.data.id,e.data.owner)]);if(t){const r=(0,ke.produce)(t,(t=>{t.data.name=e.data.name}));F.cacheClient.setQueryData([G,d(e.data.id,e.data.owner)],r)}gt(d(e.data.id,e.data.owner),e.data)}},onError:(e,t,r)=>{null!=r&&r.reversePatch&&gt(t.responseId,r.reversePatch)}}),At=(e,t,r,o)=>{const s=[];let a,n;if(t&&"object"==typeof t){const{id:r,name:o}=t;r&&o&&(a={id:r,name:o,entityType:"collection",workspaceId:e},s.push(a))}if(r&&"object"==typeof r){const t=r=>{if(r){const{id:o,name:a,folder:n}=r;n&&t(n),o&&a&&s.push({id:o,name:a,entityType:"folder",workspaceId:e})}};t(r)}if(o&&"object"==typeof o){const{id:t,name:r}=o;t&&r&&(n={id:t,name:r,entityType:"request",workspaceId:e},s.push(n))}return s},Ot=()=>(0,F.useMutation)({mutationFn:({signal:e,collectionId:t,roles:r})=>R({signal:e,collectionId:t,roles:r}),onSuccess:(e,t)=>{t.onSuccess&&t.onSuccess(e)}}),Ft=!0}}]);
//# sourceMappingURL=9199.099f70629443872e.js.map