"use strict";(self.webpackChunkworkbench_import_entity=self.webpackChunkworkbench_import_entity||[]).push([[9608],{14162:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(98276),i=n(56880),o=n(10099),r=n(97201),s=n(97504);const l=()=>{const e=(0,o.useActiveWorkspaceId)(),t=(0,a.useCreateNewEnvironment)(),{data:n}=(0,r.useDataFetch)((0,a.getEnvironmentSidebarPermissionsQuery)(e));return async(a,o)=>{if(null==n||!n.userCanCreateEnvironment)return{status:"error",description:"You do not have permission to import an environment."};if(o){const e=await(0,s.z)(o,a.name,"environment");if("cancel"===e)return{status:"error",description:"Import cancelled"};a.name=e}try{const n=await t.mutateAsync({workspaceId:e,requestBody:a});return i.AnalyticsService.addEventV2({category:"environment",action:"create",label:"import"}),{status:"success",description:"Environment imported successfully.",data:n.data}}catch(e){return e.name.includes("TimeoutError")?{status:"error",description:"Import request timed out. Please wait for some time or try again."}:{status:"error",description:"Could not import environment. Please try again."}}}}},97504:(e,t,n)=>{n.d(t,{z:()=>o});var a=n(26246),i=n(98276);const o=async(e,t,n)=>{let o=!1;const r=e?e.map((e=>(e.name===t&&(o=!0),e.name))):[];if(o){const e=a.Modals.getModals(),o=await e.showWarningDialog({uid:`${n}-import-duplicate-warning`,subject:"",message:`${"collection"===n?"A collection":"An environment"} ${t} already exists. What would you like to do?`,options:[{title:"Cancel",isDefaultOnDismiss:!0},{title:"Import as Copy",isPrimary:!0}]});return o&&"Import as Copy"===o.title?(0,i.getDuplicateEntityName)(r,t):"cancel"}return t}},8123:(e,t,n)=>{n.d(t,{Y:()=>s,n:()=>r});var a=n(21466),i=n(51759),o=n(13101);const r=async e=>{{const t=await a.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"IMPORT_FILE",payload:{fileDetails:e,userId:(0,o.getUserId)()}});if(t.err)throw new Error(t.val.message);return t.val}},s=async e=>{await a.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"DOT_ENV_METADATA_QUERY",payload:{action:i.ImportMessages.DotEnvMetadataQuery.storeEnvMetaData,data:e}})}},65482:(e,t,n)=>{n.d(t,{Z:()=>R});var a=n(7560),i=n(40540),o=n(58560),r=n(94250),s=n(9460),l=n(43652),c=n(80605),d=n(74962),m=n(32054),p=n(59530),u=n.n(p),v=n(14162),g=n(47410),h=n(23468),y=n(35736),w=n(81397),b=n(35482),x=n(38394),f=n(39245),C=n(10099),I=n(52322);const j=u()(s.ZP).withConfig({displayName:"environment-table__SecondaryText",componentId:"sc-ss3jww-0"})(["color:var(--content-color-secondary);"]),k=u()(o.Z).withConfig({displayName:"environment-table__ActionsContainer",componentId:"sc-ss3jww-1"})(["gap:var(--spacing-s);align-items:center;justify-content:flex-end;margin-right:var(--spacing-xl);"]),_=u()(h.Z).withConfig({displayName:"environment-table__StyledTable",componentId:"sc-ss3jww-2"})(["padding-left:var(--spacing-xl);padding-right:var(--spacing-xl);"]),S=u()(o.Z).withConfig({displayName:"environment-table__StatusContainer",componentId:"sc-ss3jww-3"})(["justify-content:center;align-items:center;height:100%;"]),N=u().span.withConfig({displayName:"environment-table__SeparatorDot",componentId:"sc-ss3jww-4"})(["width:6px;height:6px;border-radius:var(--border-radius-max);background-color:var(--background-color-tertiary);"]),E=({envData:e,isImporting:t,rowsSelected:n,setRowsSelected:a,setSelectedEnvironment:i,importEnvFile:o,searchText:r})=>{const s=(0,f.useNavigate)(),l=(0,C.useActiveWorkspaceId)(),d=[{Header:"Name",accessor:"name",cellWidth:"30%"},{Header:"Variables",accessor:"content",Cell:({value:e})=>(0,I.jsxs)(j,{children:[null==e?void 0:e.length," variable",(0,g._6)(null==e?void 0:e.length)]}),cellWidth:"20%"},{Header:"Path",accessor:"path",Cell:({value:e})=>(0,I.jsx)(j,{children:e})}],m={id:"action",accessor:"path",cellWidth:"20%",Cell:e=>{const{path:t,status:n,environmentId:a}=e.row.original,r=null==n?void 0:n.error,d=null==n?void 0:n.success;return(0,I.jsxs)(k,{children:[r&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(c.Z,{onClick:()=>o(e.row.original),type:"plain",text:"Retry","data-testid":"retry-btn"}),(0,I.jsx)(N,{})]}),d&&a?(0,I.jsx)(c.Z,{onClick:()=>(e=>{s(`/workspace/${l}/environment/${e}`,{},{customNavEvent:f.OPEN_EXTENSION_URL})})(a),type:"plain",text:"Open"}):(0,I.jsx)(c.Z,{onClick:()=>i(t),type:"plain",text:"Edit",isDisabled:null==n?void 0:n.isLoading,"data-testid":"edit-btn"})]})}},p=t?[{id:"status",accessor:"status",cellWidth:"4%",Cell:({value:e})=>{return(0,I.jsx)(S,{children:(t=e,t?t.isLoading?(0,I.jsx)(y.Z,{}):t.error?(0,I.jsx)(w.Z,{content:t.error,children:(0,I.jsx)(b.Z,{"data-testid":"import-status-icon",color:"content-color-error"})}):t.success?(0,I.jsx)(w.Z,{content:"Imported successfully",children:(0,I.jsx)(x.Z,{"data-testid":"import-status-icon",color:"content-color-success"})}):null:null)});var t}},...d,m]:[...d,m];return(0,I.jsx)(_,{data:e,columns:p,globalFilter:{filter:r},rowSelected:t?{}:{onSelect:e=>a(e),initialSelectionState:n}})};var Z=n(85692),T=n(8123),D=n(56880);const A=u()(o.Z).withConfig({displayName:"environments-preview-list__ImportListContainer",componentId:"sc-1irso76-0"})(["padding-left:var(--spacing-l);padding-right:var(--spacing-l);flex-direction:column;"]),V=u()(r.Z).withConfig({displayName:"environments-preview-list__StyledBanner",componentId:"sc-1irso76-1"})(["margin-top:var(--spacing-l);"]),M=u()(o.Z).withConfig({displayName:"environments-preview-list__HeaderSection",componentId:"sc-1irso76-2"})(["flex-direction:column;gap:var(--spacing-xs);padding:var(--spacing-m) var(--spacing-l);border-bottom:var(--border-color-default) var(--border-width-default) solid;"]),F=u()(s.ZP).withConfig({displayName:"environments-preview-list__SecondaryText",componentId:"sc-1irso76-3"})(["color:var(--content-color-secondary);"]),O=u()(l.Z).withConfig({displayName:"environments-preview-list__SearchContainer",componentId:"sc-1irso76-4"})(["margin:var(--spacing-l) 0;"]),$=u()(o.Z).withConfig({displayName:"environments-preview-list__Footer",componentId:"sc-1irso76-5"})(["margin-right:var(--spacing-xl);margin-top:var(--spacing-xl);"]),P=u()(c.Z).withConfig({displayName:"environments-preview-list__StyledButton",componentId:"sc-1irso76-6"})([":disabled{background-color:var(--button-primary-background-color) !important;color:var(--button-primary-content-color) !important;opacity:0.5;}"]),R=({detectedEnvCount:e,envCountWithNoVariables:t,envData:n,setEnvData:o,setSelectedEnvironment:r,rowsSelected:s,setRowsSelected:l})=>{const[p,u]=(0,i.useState)(""),[h,y]=(0,i.useState)(!1),w=(0,v.Z)(),b=(0,C.useActiveWorkspaceId)(),x=Object.keys(s).length,f=(e,t)=>{o((n=>n.map((n=>n.path===e?(0,a.Z)({},n,t):n))))},j=async e=>{const t={status:{isLoading:!0}};f(e.path,t);try{const i=(0,g.Jt)(e),o=await w(i);var n,a;if("success"===o.status&&(t.status={isLoading:!1,success:!0},t.environmentId=`${null==(n=o.data)?void 0:n.owner}-${null==(a=o.data)?void 0:a.id}`,await(0,Z.setSession)({model:"environment",modelId:t.environmentId},{values:(0,g.A)(e)}),await(0,T.Y)({environmentId:t.environmentId,environmentMetaData:{path:e.path,workspaceId:b}}),D.AnalyticsService.addEventV2({category:"environment",action:"create",label:"import-dot-env-file-success"})),"error"===o.status)throw new Error(o.description)}catch(e){t.status={isLoading:!1,error:e.message},D.AnalyticsService.addEventV2({category:"environment",action:"create",label:"import-dot-env-file-error",meta:e.message})}finally{f(e.path,t)}},k=()=>{for(const e of n)e.status.success||j(e)};return(0,i.useEffect)((()=>{if(h)for(const e of n)j(e)}),[h]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(M,{children:[(0,I.jsx)(d.Z,{type:"h4",text:"Import Environments"}),(0,I.jsx)(F,{type:"body-small","data-testid":"import-status-description",children:(()=>{const t=n.length;if(!h)return`${e} new file${(0,g._6)(e)} detected`;const a=n.filter((e=>{var t;return null==(t=e.status)?void 0:t.success})).length,i=t-a;return n.some((e=>{var t;return null==(t=e.status)?void 0:t.isLoading}))?"Importing...":(0,I.jsxs)(I.Fragment,{children:[a>0&&`${a} imported`,a>0&&i>0&&", ",i>0&&(0,I.jsxs)(I.Fragment,{children:[`${i} failed `,(0,I.jsx)(c.Z,{onClick:k,type:"plain",text:"Retry",size:"small","data-testid":"common-retry-btn"})]})]})})()})]}),(0,I.jsxs)(A,{"data-testid":"import-list-container",children:[t>0&&(0,I.jsxs)(V,{children:["Excluded ",t," file",(0,g._6)(t)," with no environment variables."]}),(0,I.jsx)(O,{type:"search",value:p,onClear:()=>u(""),onChange:e=>{u(e.target.value)},placeholder:"Search by name",width:"40%",prefix:(0,I.jsx)(m.Z,{})}),(0,I.jsx)(E,{envData:n,isImporting:h,rowsSelected:s,setRowsSelected:l,setSelectedEnvironment:r,importEnvFile:j,searchText:p}),(0,I.jsx)($,{justifyContent:"flex-end",children:h?null:(0,I.jsx)(P,{onClick:async()=>{const e=[];for(const t of Object.keys(s))e.push(n[Number(t)]);o(e),y(!0),D.AnalyticsService.addEventV2({category:"import",action:"import-multiple-dot-env-file-start",value:e.length})},type:"primary",text:`Import (${x})`,"data-testid":"import-btn",isDisabled:0===x})})]})]})}},85646:(e,t,n)=>{n.d(t,{Z:()=>I});var a=n(40540),i=n(59530),o=n.n(i),r=n(58560),s=n(80605),l=n(82196),c=n(64495),d=n(96557),m=n(52322);const p=o()(r.Z).withConfig({displayName:"tab-header__TabHeaderFlex",componentId:"sc-1pmcyp9-0"})(["box-sizing:border-box;padding:var(--spacing-m) var(--spacing-l);border-bottom:var(--border-width-default) var(--border-style-solid) var(--border-color-default);"]),u=o().div.withConfig({displayName:"tab-header__BreadcrumbContainer",componentId:"sc-1pmcyp9-1"})(["color:var(--content-color-primary);font-weight:var(--text-weight-medium);width:100%;"]),v=({envName:e,handleBack:t,handleNameChange:n})=>{const a=[{name:"Import Environments"},{name:e,entityType:"envName"}],i=t=>{e!==t&&n(t)};return(0,m.jsxs)(p,{alignItems:"center",children:[(0,m.jsx)(s.Z,{type:"muted-plain",size:"small",icon:(0,m.jsx)(d.Z,{color:"content-color-secondary"}),onClick:t,"data-testid":"back-btn"}),(0,m.jsx)(u,{children:(0,m.jsx)(l.aG,{onItemClick:e=>{"Import Environments"===e.name&&t()},children:a.map((t=>(0,m.jsx)(c.Z,{enableRename:"envName"===t.entityType,renameInputConfig:{onSubmit:i,value:e},itemData:t,children:t.name},t.name)))})})]})};var g=n(7560),h=n(98283),y=n(19956);const w=["entityType","onChange","values"],b=o().div.withConfig({displayName:"variable-editor__StyledVariablesEditor",componentId:"sc-1lu8k6b-0"})(["padding:0 var(--spacing-l);min-height:0;"]),x=function(e){const{entityType:t="environment",onChange:n,values:i}=e,o=(0,h.Z)(e,w),[r,s]=(0,a.useState)([]);return(0,a.useMemo)((()=>{const e=new Set([]),t=((e,t)=>(n,a,i)=>{var o,r;let s=-1;return(null==(o=e[i])?void 0:o.key)===n&&(s=i),(null==(r=e[i])?void 0:r.value)===a&&(s=i),-1===s&&(s=e.findIndex(((e,a)=>e.key===n&&!t.has(a)))),-1===s&&(s=e.findIndex(((e,n)=>e.value===a&&!t.has(n)))),-1!==s?(t.add(s),e[s]):null})(r,e),n=i.map(((e,n)=>{var a,i;return{key:e.key,value:e.value,isMasked:"secret"===e.type&&(null==(a=null==(i=t(e.key,e.value,n))?void 0:i.isMasked)||a)}}));s(n)}),[i]),(0,m.jsx)(b,{children:(0,m.jsx)(y.KeyValueEditor,(0,g.Z)({tableName:`Variables Editor - ${t}`,entityType:t,keyHeading:"Variable",valueHeading:"Initial value",sessionHeading:"Current value",valuePlaceholder:"",values:i,onChange:e=>{n(e)},showColumns:["key","variableType","value","sessionValue"],allowedColumns:["key","variableType","value","sessionValue"],disableCreate:!0,maskStatesMap:r,toggleMaskValue:e=>{const t=r[e],n=[...r];n[e]=(0,g.Z)({},t,{isMasked:!t.isMasked}),s(n)},initialColumnWidths:[23,14,30,33],enableFiltering:!0,enableScroll:!0,disallowDuplicates:!0},o))})},f=o()(r.Z).withConfig({displayName:"environment-variable-editor__StyledFlex",componentId:"sc-mrhu6f-0"})(["gap:var(--spacing-m);"]),C=o()(r.Z).withConfig({displayName:"environment-variable-editor__Footer",componentId:"sc-mrhu6f-1"})(["padding:var(--spacing-l);padding-top:0;"]),I=({envData:e,handleBack:t,handleChange:n,handleReset:a})=>(0,m.jsxs)(f,{direction:"column",height:"100%",children:[(0,m.jsx)(v,{envName:e.name,handleBack:t,handleNameChange:e=>{n("name",e)}}),(0,m.jsx)(x,{values:e.content,onChange:e=>{n("content",e)}}),(0,m.jsxs)(C,{justifyContent:"space-between",children:[(0,m.jsx)(s.Z,{onClick:a,type:"outline",text:"Reset","data-testid":"reset-btn"}),(0,m.jsx)(s.Z,{onClick:t,type:"primary",text:"Done","data-testid":"done-btn"})]})]})},47410:(e,t,n)=>{n.d(t,{A:()=>c,Ef:()=>d,Jt:()=>s,QR:()=>l,_6:()=>r});var a=n(7560),i=n(13101),o=n(60398);const r=e=>Number(e)>1?"s":"",s=e=>({id:(0,o.v4)(),owner:(0,i.getUserId)(),name:e.name,values:e.content.map((e=>({key:e.key,value:e.value,enabled:e.enabled,type:e.type})))}),l=e=>e.map((e=>(0,a.Z)({},e,{content:e.content.map((e=>(0,a.Z)({},e,{sessionValue:e.value})))}))).filter((e=>e.content.length>0)),c=e=>e.content.map((e=>({key:e.key,value:e.sessionValue,enabled:e.enabled,type:e.type}))),d=e=>e.filter((e=>0===e.content.length)).length},91246:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(32234);const i=()=>{if(window.NAVIGATION_CONTEXT){const t=JSON.parse(window.NAVIGATION_CONTEXT);try{var e;return JSON.parse(a.Base64.decode(null==t||null==(e=t.options)?void 0:e.importData))}catch(e){return{}}}return{}}}}]);
//# sourceMappingURL=9608.f0c284bc03d150f5.js.map