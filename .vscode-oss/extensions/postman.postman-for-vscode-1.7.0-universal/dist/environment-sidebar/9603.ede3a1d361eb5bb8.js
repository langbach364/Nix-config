"use strict";(self.webpackChunkenvironment_sidebar=self.webpackChunkenvironment_sidebar||[]).push([[9603],{9603:(e,n,t)=>{t.r(n),t.d(n,{ActiveEnvironmentSelector:()=>Kn,ENVIRONMENTS_SIDEBAR_PERMISSIONS_QUERY_KEY_PREFIX:()=>g,ENVIRONMENT_BROADCAST_EVENT_ACTIONS:()=>R,ENVIRONMENT_ITEM_BROADCAST_EVENT_ACTIONS:()=>N,ENVIRONMENT_ITEM_QUERY_KEY_PREFIX:()=>b,ENVIRONMENT_LIST_QUERY_KEY_PREFIX:()=>v,ENVIRONMENT_SELECTOR_PERMISSIONS_QUERY_KEY_PREFIX:()=>E,ENVIRONMENT_WORKBENCH_PERMISSIONS_QUERY_KEY_PREFIX:()=>w,GLOBALS_BROADCAST_EVENT_ACTIONS:()=>T,GLOBALS_ITEM_QUERY_KEY_PREFIX:()=>y,GLOBALS_WORKBENCH_PERMISSIONS_QUERY_KEY_PREFIX:()=>f,SECRET:()=>de,VariablesContextProvider:()=>q,VariablesContextStore:()=>l,WORKSPACE_BROADCAST_EVENT_ACTIONS:()=>L,WORKSPACE_QUERY_KEY_PREFIX:()=>h,environmentItemsQuery:()=>M,environmentVariablesHandler:()=>ct,environmentsSubscriptionHandler:()=>vt,getActiveEnvironment:()=>V,getActiveEnvironmentSession:()=>ut,getActiveGlobalsSession:()=>pt,getDuplicateEntityName:()=>oe,getDynamicVariableQuery:()=>Fn,getEnvironmentItemQuery:()=>bn,getEnvironmentItemQuerySafe:()=>hn,getEnvironmentSelectorPermissionsQuery:()=>Vn,getEnvironmentSidebarPermissionsQuery:()=>kn,getEnvironmentWorkbenchPermissionsQuery:()=>On,getGlobalsItemQuery:()=>yn,getGlobalsWorkbenchPermissionsQuery:()=>Ln,globalVariablesHandler:()=>dt,isEnvironmentItemLoading:()=>Mn,resolveVariablesInObject:()=>it,setActiveEnvironment:()=>j,unZipVariables:()=>ce,updateEnvironment:()=>st,updateEnvironmentCacheAndSession:()=>x,updateEnvironmentMutation:()=>zn,updateEnvironmentNameMutation:()=>at,updateEnvironmentWithSessionMutation:()=>Xn,updateGlobals:()=>lt,updateGlobalsCacheAndSession:()=>A,updateGlobalsMutation:()=>tt,updateGlobalsWithSessionMutation:()=>rt,useActiveAndDynamicVariables:()=>ye,useActiveEnvironment:()=>B,useActiveVariables:()=>he,useCreateNewEnvironment:()=>X,useCurrentEnvironmentId:()=>Ce,useEnvironmentDelete:()=>z,useEnvironmentDuplicate:()=>ae,useEnvironmentFeatureFlag:()=>Z,useEnvironmentItems:()=>U,useEnvironmentListSubscription:()=>ne,useEnvironmentSubscription:()=>ie,useSetAsActiveEnvironment:()=>te,useUpdateEnvironmentName:()=>fe,useUpdateEnvironmentRoles:()=>ke,zipVariables:()=>le});var r=t(8476),o=t(9875);const a=new o.KVStorage("last-used-active-environment"),i=async e=>await a.get(e)||null,s={queryFn:()=>Promise.reject(),enabled:!1,useErrorBoundary:!1};class l{constructor({collectionFetchOptions:e},n){this.activeEnvironment=null,this.collectionFetchOptions=void 0,this.meta=void 0,this.useActiveEnvironmentFromContext=void 0,this.loadLastUsedActiveEnvironment=()=>{i(this.meta.workspaceId).then((e=>{(0,r.runInAction)((()=>{this.activeEnvironment=e}))})).catch((()=>{}))},this.setActiveEnvironment=e=>{this.activeEnvironment=e,(async(e,n)=>(await a.set(e,n),n))(this.meta.workspaceId,e).catch((()=>{}))},this.meta=n,this.useActiveEnvironmentFromContext=!e,this.collectionFetchOptions=e||s,(0,r.makeObservable)(this,{activeEnvironment:r.observable,setActiveEnvironment:r.action}),this.useActiveEnvironmentFromContext&&this.loadLastUsedActiveEnvironment()}}var c=t(540),d=t.n(c),u=t(7201),p=t(99),m=t(5860);const v="environments",b="environment",h="workspace",y="globals",g="environment-sidebar-permissions",w="environment-workbench-permissions",f="globals-workbench-permissions",E="environment-selector-permissions",C=new class{constructor(){var e=this;this.observer=null,this.environmentId="",this.abortController=null,this.asyncObserver=null,this.changeEnvironment=e=>{this.environmentId&&this.unsubscribe(),this.environmentId=e},this.subscribe=async function({environmentId:n=e.environmentId,subscriptionHandler:t}){if(""===n)return;if(e.environmentId!==n&&e.changeEnvironment(n),e.observer||e.asyncObserver)return;const{asyncObserver:r,abortController:o}=(e=>{const n=new AbortController;return{asyncObserver:m.postmanWebsocketGateway.subscribe({signal:n.signal,subscribeRequest:{method:"post",service:"sync",url:`/environment/${e}/subscribe`,data:{}},subscriptionEvents:["update","update_roles"],responseFilter:e=>{var n;return null==e||null==(n=e.body)?void 0:n.model_id},broadcastFilter:e=>null==e?void 0:e.model_id,unsubscribeRequest:{method:"delete",service:"sync",url:`/environment/${e}/subscribe`,data:{}}}),abortController:n}})(n);e.abortController=o,e.asyncObserver=r,e.observer=await r,e.abortController=null,(0,u.invalidateCache)([b,n]),e.observer.subscribe({next:e=>{t(e,{environmentId:n})},complete:()=>{e.unsubscribe()},error:async function(r){e.cleanup(),await e.subscribe({subscriptionHandler:t,environmentId:n})}})},this.unsubscribe=()=>{var e,n;null==(e=this.abortController)||e.abort(),null==(n=this.observer)||n.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}};var k=t(5692),I=t(6663),_=t.n(I);const S=e=>Object.assign({},e,{id:`${e.owner}-${e.id}`}),x=async(e,n)=>{const t=S(n);(0,u.updateCache)({key:[b,e],updater:e=>e?Object.assign({},e,t):e}),await(0,k.updateDependentSession)({model:"environment",modelId:t.id},t)},A=async(e,n)=>{(0,u.updateCache)({key:[y,e],updater:e=>e?Object.assign({},e,n):e}),await(0,k.updateDependentSession)({model:"globals",modelId:n.id},n)};var O=t(4350);let T=function(e){return e.UPDATE="update",e}({}),R=function(e){return e.DELETE="delete",e.CREATE="create",e.UPDATE="update",e}({}),N=function(e){return e.UPDATE="update",e.UPDATE_ROLES="update_roles",e}({}),L=function(e){return e.UPDATE="update",e.UPDATE_ROLES="update_roles",e}({});const D=(e,{environmentId:n})=>{var t;const r=null==e||null==(t=e.meta)?void 0:t.action,o=null==e?void 0:e.data;if(r&&o)switch(r){case N.UPDATE:x(n,o);break;case N.UPDATE_ROLES:(0,u.invalidateCache)([O.ACCESS_CONTROL_QUERY_KEY_PREFIX,O.ALL_ROLES,"environment",n])}},P=new o.KVStorage("active-environment"),V=async e=>P.get(F(e)),j=async(e,n)=>{return P.set(F(e),(t=n,JSON.parse(JSON.stringify(t))));var t},F=({model:e,modelId:n})=>[e,n].join("/"),$=()=>P,M=e=>({queryKey:[v,e],queryFn:({signal:n})=>(async({signal:e,workspaceId:n})=>{const t=await m.postmanGateway.post({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/list/environment`,headers:{"Content-type":"text/plain"},signal:e,query:{workspace:n}});if(!Array.isArray(null==t?void 0:t.data))throw new TypeError("Received invalid response from server");return t.data})({signal:n,workspaceId:e}),select:e=>(Array.isArray(e)&&e.sort(((e,n)=>e.name.localeCompare(n.name))),e),useErrorBoundary:!1}),U=({workspaceId:e})=>(0,u.useDataFetch)(M(e)),B=()=>{const e=(0,p.useActiveWorkspaceId)(),n=(0,c.useContext)(H);if(!n)throw new Error("useActiveEnvironment must be used within a VariablesContextProvider");const[t,a]=(0,c.useState)(n.activeEnvironment);(0,c.useEffect)((()=>{if(n.useActiveEnvironmentFromContext)return(0,r.reaction)((()=>n.activeEnvironment),a)}),[n]);const{data:i}=(0,u.useDataFetch)(n.collectionFetchOptions),s=i?F({model:"collection",modelId:i.id}):"",{value:l}=(0,o.useKVStorage)($(),s),d=n.useActiveEnvironmentFromContext?t:l,{data:m,isLoading:v,isError:b}=U({workspaceId:e}),h=(null==d?void 0:d.id)&&(null==m?void 0:m.some((({id:e})=>e===d.id)));return h?{data:d,isLoading:v,isError:b}:{data:null,isLoading:v,isError:b}};var W=t(2322);const H=(0,c.createContext)(void 0),G=()=>{const{data:e}=B();return(0,c.useEffect)((()=>{if(e)return C.subscribe({environmentId:e.id,subscriptionHandler:D}),()=>C.unsubscribe()}),[e]),null},q=({store:e,children:n})=>((e=>{const n=(0,p.useActiveWorkspaceId)(),{data:t}=(0,u.useDataFetch)(e.collectionFetchOptions);(0,c.useEffect)((()=>{null!=t&&t.id&&(async e=>P.has(F(e)))({model:"collection",modelId:t.id}).then((e=>{if(!e)return i(n).then((e=>j({model:"collection",modelId:t.id},e)))}))}),[t])})(e),(0,W.jsxs)(H.Provider,{value:e,children:[(0,W.jsx)(G,{}),n]}));var Q=t(398),K=t(9245),Y=t(6880);const Z=()=>!0,z=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:({environmentId:e})=>(async e=>{const n=await m.postmanGateway.delete({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`});return await(0,k.deleteDependentSession)({model:"environment",modelId:e}),n})(e),onMutate:async({workspaceId:n,environmentId:t})=>{const r=[v,n];await e.cancelQueries({queryKey:r}),(0,u.updateCache)({key:r,updater:e=>e?e.filter((({id:e})=>e!==t)):e})},onSettled:(e,n,{workspaceId:t})=>{(0,u.invalidateCache)([v,t])}})},X=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:({workspaceId:e,requestBody:n})=>(async(e,n)=>await m.postmanGateway.post({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/environment/import`,body:JSON.stringify(n),query:{workspace:e}}))(e,n),onMutate:async({workspaceId:n,requestBody:t})=>{const r=[v,n];await e.cancelQueries({queryKey:r}),e.setQueryData(r,(e=>[...null!=e?e:[],{id:window.USER_ID+"-"+t.id,name:t.name,isLoading:!0}]))},onSettled:(e,n,{workspaceId:t})=>{(0,u.invalidateCache)([v,t])},useErrorBoundary:!1})},J=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:n=e.workspaceId,subscriptionHandler:t}){if(""===n)return;if(e.workspaceId!==n&&e.changeWorkspace(n),e.observer||e.asyncObserver)return;const{asyncObserver:r,abortController:o}=(e=>{const n=new AbortController;return{asyncObserver:m.postmanWebsocketGateway.subscribe({signal:n.signal,subscribeRequest:{method:"post",url:`/list/environment?workspace=${e}&subscribe=true`,service:"sync"},subscriptionEvents:["broadcast"],responseFilter:e=>{var n;return null==e||null==(n=e.body)||null==(n=n.subscription)?void 0:n.id},broadcastFilter:e=>{var n;return null==e||null==(n=e.data)||null==(n=n.subscription)?void 0:n.id},unsubscribeRequest:{data:{},method:"delete",url:`/list/environment/subscribe?workspace=${e}`,service:"sync"}}),abortController:n}})(n);e.abortController=o,e.asyncObserver=r,e.observer=await r,e.abortController=null,(0,u.invalidateCache)([v,n]),e.observer.subscribe({next:e=>{t(e,{workspaceId:n})},complete:()=>{e.unsubscribe()},error:async function(r){e.cleanup(),await e.subscribe({subscriptionHandler:t,workspaceId:n})}})},this.unsubscribe=()=>{var e,n;null==(e=this.abortController)||e.abort(),null==(n=this.observer)||n.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}},ee=(e,{workspaceId:n})=>{var t;const r=null==e||null==(t=e.data)?void 0:t.data;if(!Array.isArray(r))return;const o=[],a=[],i=[];for(const e of r)switch(e.action){case R.CREATE:a.push(e.id);break;case R.DELETE:o.push(e.id);break;case R.UPDATE:i.push(e.id)}a.length>0||i.length>0?(0,u.invalidateCache)([v,n]):o.length>0&&((e,n)=>{0!==e.length&&(0,u.updateCache)({key:[v,n],updater:n=>Array.isArray(n)?n.filter((n=>!e.includes(n.id))):n})})(o,n)},ne=e=>{(0,c.useEffect)((()=>{if(e)return J.subscribe({workspaceId:e,subscriptionHandler:ee}),()=>{J.unsubscribe()}}),[e])},te=()=>{const e=(0,c.useContext)(H);if(!e)throw new Error("useSetAsActiveEnvironment must be used within a VariablesProvider");const{data:n}=(0,u.useDataFetch)(e.collectionFetchOptions),t=n?F({model:"collection",modelId:n.id}):"",{setValue:r}=(0,o.useKVStorage)($(),t);return{mutate:n=>{e.setActiveEnvironment(n),!e.useActiveEnvironmentFromContext&&t&&r(n)}}},re=e=>{const n=e.split(" "),t=n.length,r=n[t-1],o=Number.parseInt(r);return t>=2&&"Copy"===r?e+" 2":t>=3&&"Copy"===n[t-2]&&!Number.isNaN(o)?(n[t-1]=`${o+1}`,n.join(" ")):e+" Copy"},oe=(e,n="")=>{const t=new Set(e);let r=n;for(;t.has(r);)r=re(r);return r},ae=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:e=>(async({environmentId:e,workspaceId:n})=>await m.postmanGateway.post({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}/duplicate`,query:{workspace:n},data:{}}))(e),onMutate:async({workspaceId:n,environmentId:t})=>{const r=[v,n];await e.cancelQueries({queryKey:r});const o=e.getQueryData(r);if(!o)return;const{name:a}=o.find((({id:e})=>e===t));(0,u.updateCache)({key:r,updater:e=>e?[...e,{id:window.USER_ID+"-"+t,name:oe([a],a),isLoading:!0}]:e})},onSettled:(e,n,{workspaceId:t})=>{(0,u.invalidateCache)([v,t])}})},ie=(e="")=>{(0,c.useEffect)((()=>{if(e)return C.subscribe({environmentId:e,subscriptionHandler:D}),()=>{C.unsubscribe()}}),[e])},se=(e,n=new Set)=>t=>{var r;const o=e.findIndex(((e,r)=>e.key===t.key&&e.enabled===t.enabled&&!n.has(r)));let a;return-1===o?a={value:t.value}:(n.add(o),a=e[o]),{key:t.key,value:t.value,sessionValue:a.value,isSessionValueDeleted:null==(r=a)?void 0:r.deleted,enabled:t.enabled,type:t.type}},le=(e,n)=>e.map(se(n)),ce=e=>e.reduce((({initialValues:e,sessionValues:n},t)=>{const{key:r,value:o,sessionValue:a,enabled:i,type:s,isSessionValueDeleted:l}=t;return n.push({key:r,value:a,enabled:i,type:s,deleted:!!l||void 0}),e.push({key:r,value:o,enabled:i,type:s}),{initialValues:e,sessionValues:n}}),{initialValues:[],sessionValues:[]}),de="secret",ue={queryKey:["empty-collection"],queryFn:()=>Promise.reject(),enabled:!1},pe=(e,n,t=se(n))=>n=>n.map((n=>Object.assign({},t(n),{scope:e}))),me=()=>{var e;const n=(0,p.useActiveWorkspaceId)(),{collectionFetchOptions:t}=null!=(e=(0,c.useContext)(H))?e:{collectionFetchOptions:ue},{data:r}=(0,u.useDataFetch)(yn(n)),{data:o}=(0,u.useDataFetch)(Fn()),{data:a}=(0,u.useDataFetch)(t),{data:i}=B(),{data:s}=(0,u.useDataFetch)(hn(null==i?void 0:i.id)),l=(0,k.useSessionSafe)({model:"environment",modelId:null==s?void 0:s.id}),d=(0,k.useSessionSafe)({model:"globals",modelId:null==r?void 0:r.id}),m=(0,k.useSessionSafe)({model:"collection",modelId:null==a?void 0:a.id});return(0,c.useMemo)((()=>{var e,n,t,i,c,u,p,v,b,h;return{data:[...(h=o,h||[]),...pe("globals",null!=(e=null==(n=d.value)?void 0:n.values)?e:[])(null!=(t=null==r?void 0:r.values)?t:[]),...pe("collection",null!=(i=null==(c=m.value)?void 0:c.values)?i:[])(null!=(u=null==a?void 0:a.variables)?u:[]),...pe("environment",null!=(p=null==(v=l.value)?void 0:v.values)?p:[])(null!=(b=null==s?void 0:s.values)?b:[])].map(((e,n)=>Object.assign({},e,{id:`${e.scope}::${n}`})))}}),[a,m.value,s,l.value,r,d.value,o])},ve=e=>{const n=e.filter((e=>"dynamic"===e.type));return[...e.filter((e=>"dynamic"!==e.type)),...n]},be=e=>{const n=e.filter((e=>{return"boolean"!=typeof(n=e).enabled||n.enabled;var n})),t=(e=>{const n=new Map(e.map((e=>[e.key,e])));return e=>{const t=n.get(e.key);return t&&t.id!==e.id?Object.assign({},e,{overriddenBy:{id:t.id,scope:t.scope}}):e}})(n),r=n.map((e=>t(e)));return{data:ve(r)}},he=()=>{const{data:e}=me();return(0,c.useMemo)((()=>{if(!e)return{};const n=e.filter((e=>"dynamic"!==e.type));return be(n)}),[e])},ye=()=>{const{data:e}=me();return(0,c.useMemo)((()=>e?be(e):{}),[e])},ge=async({environmentId:e,name:n})=>await m.postmanGateway.put({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`,data:{name:n}}),we=(e,n,t)=>{(0,u.updateCache)({key:e,updater:e=>e?e.map((e=>e.id===n?Object.assign({},e,{name:t}):e)):e})},fe=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:e=>ge(e),onMutate:async({workspaceId:n,environmentId:t,name:r})=>{const o=[v,n],a=e.getQueryData(o);if(!a)return;const i=a.find((({id:e})=>e===t));return we(o,t,r),()=>{i&&we(o,t,i.name)}},onSuccess:(e,{workspaceId:n,environmentId:t})=>{we([v,n],t,e.data.name)},onError:(e,n,t)=>{t&&t()}})};var Ee=t(607);const Ce=()=>{const{pathname:e}=(0,K.useLocation)(),{environmentId:n}=(0,Ee.useParams)();return n||(null!=e&&e.endsWith("/globals")?"globals":void 0)},ke=()=>(0,u.useMutation)({mutationFn:({signal:e,environmentId:n,roles:t})=>(async({signal:e,environmentId:n,roles:t})=>await m.postmanGateway.put({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/environment/${n}/roles`,data:{roles:t},signal:e}))({signal:e,environmentId:n,roles:t}),onSuccess:(e,n)=>{n.onSuccess&&n.onSuccess(e)}});var Ie=t(9530),_e=t.n(Ie),Se=t(1314),xe=t.n(Se),Ae=t(9721),Oe=t(3753);const Te=["click","mouseenter","focus","focusin"],Re=_e()(Ae.ZP).withConfig({displayName:"Popover__StyledPopover",componentId:"xu341w-0"})(["& .tippy-content{min-width:120px;z-index:1000;background-color:",";border-radius:",";padding:",";box-shadow:",";font-family:",";font-size:",";line-height:",";font-weight:",";}& .tippy-svg-arrow > svg{filter:",";}& .tippy-svg-arrow > svg > path{fill:",";}"],(e=>e.theme["popover-background-color"]),(e=>e.theme["border-radius-default"]),(e=>e.theme[e.padding]),(e=>e.theme["popover-box-shadow"]),(e=>e.theme["text-family-default"]),(e=>e.theme["text-size-m"]),(e=>e.theme["line-height-m"]),(e=>e.theme["text-weight-regular"]),(e=>e.theme["popover-pointer-filter"]),(e=>e.theme["popover-background-color"]));function Ne(e){const[n,t]=(0,c.useState)({}),{children:r,className:o,delay:a,openAnimationDuration:i,closeAnimationDuration:s,isOpen:l,onOpen:u,onClose:p,gap:m,maxWidth:v,onClickOutside:b,padding:h,placement:y,trigger:g,triggerEvent:w,triggerRef:f,appendTo:E,pointer:C,xOffset:k,getReferenceClientRect:I,"data-testid":_,"data-click":S}=e,x=C?m+11:m;function A(e){27===e.keyCode&&("boolean"==typeof l&&b?b(e):n&&n.hide())}function O(){document.addEventListener("keydown",A),u&&u()}function T(){document.removeEventListener("keydown",A),p&&p()}function R(){b&&b()}return null!==l?d().createElement(Re,{visible:l,onCreate:e=>t(e),content:r,placement:y,interactive:!0,delay:[a,null],duration:[i,s],maxWidth:v,className:`aether-popover ${o}`,"data-aether-id":"aether-popover","data-testid":_,"data-click":S,arrow:!!C&&'<svg\n        width="20"\n        height="11"\n        viewBox="0 0 20 11"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M11.5365 0.843729L20.0001 11L8.91685e-05 11L8.46365 0.843731C9.26324 -0.115777 10.7369 -0.115779 11.5365 0.843729Z"\n        />\n      </svg>',appendTo:E||document.getElementById("aether-popover-portal"),reference:f,onShow:O,onHide:T,padding:h,offset:[k,x],onClickOutside:R,getReferenceClientRect:I},g):d().createElement(Re,{onCreate:e=>t(e),content:r,placement:y,trigger:w,interactive:!0,delay:[a,null],duration:[i,s],maxWidth:v,className:`aether-popover ${o}`,"data-aether-id":"aether-popover","data-testid":_,"data-click":S,arrow:!!C&&'<svg\n      width="20"\n      height="11"\n      viewBox="0 0 20 11"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path\n        d="M11.5365 0.843729L20.0001 11L8.91685e-05 11L8.46365 0.843731C9.26324 -0.115777 10.7369 -0.115779 11.5365 0.843729Z"\n      />\n    </svg>',appendTo:E||document.getElementById("aether-popover-portal"),reference:f,onShow:O,onHide:T,padding:h,offset:[k,x],onClickOutside:R,getReferenceClientRect:I},g)}Ne.defaultProps={children:null,className:"",delay:0,openAnimationDuration:275,closeAnimationDuration:250,isOpen:null,gap:4,xOffset:0,maxWidth:320,onClickOutside:null,padding:"spacing-s",placement:"bottom-end",trigger:null,triggerEvent:"click",triggerRef:null,appendTo:null,pointer:!1,getReferenceClientRect:null,onOpen:null,onClose:null,"data-testid":"aether-popover","data-click":""},Ne.propTypes={children:xe().oneOfType([xe().arrayOf(xe().node),xe().node]),className:xe().string,delay:xe().number,openAnimationDuration:xe().number,closeAnimationDuration:xe().number,isOpen:xe().bool,gap:xe().number,xOffset:xe().number,maxWidth:xe().oneOfType([xe().number,xe().string]),onClickOutside:xe().func,onOpen:xe().func,onClose:xe().func,padding:xe().oneOf(Object.keys(Oe.globals.spacing)),placement:xe().oneOf(["auto","top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"]),trigger:xe().object,triggerRef:xe().object,appendTo:xe().oneOfType([xe().oneOf(["parent"]),xe().object]),triggerEvent:e=>{const{triggerEvent:n}=e;return"string"!=typeof n?new Error("Popover: triggerEvent prop only accepts string as a valid value."):"string"==typeof n&&n.split(" ").filter((e=>!Te.includes(e))).length?new Error(`Popover: the value of triggerEvent prop must be from ${Te}.`):null},pointer:xe().bool,getReferenceClientRect:xe().func,"data-testid":xe().string,"data-click":xe().string};var Le=t(6415),De=t(605);const Pe=_e().div.withConfig({displayName:"SplitButton__StyledSplitButton",componentId:"sc-1uqtf3s-0"})(["width:max-content;box-sizing:border-box;cursor:pointer;user-select:none;display:inline-flex;align-items:center;border-radius:",";height:",";",";& .aether-split-button__primary-btn:disabled{border-top-right-radius:0;border-bottom-right-radius:0;}& .aether-split-button__secondary-btn:disabled{border-top-left-radius:0;border-bottom-left-radius:0;}&:hover{& .aether-split-button__splitter{border-left-color:transparent;}}&:active{& .aether-split-button__splitter{border-left-color:transparent;}}"],(e=>e.theme["border-radius-default"]),(e=>e.theme["size-m"]),(e=>function(e,n){switch(e){case"primary":return`\n        background-color: ${n["button-primary-background-color"]};\n\n        & .aether-split-button__splitter {\n          border-left-color: ${n["splitbutton-primary-splitter-color"]};\n        }\n      `;case"secondary":return`\n        background-color: ${n["button-secondary-background-color"]};\n\n        & .aether-split-button__splitter {\n          border-left-color: ${n["splitbutton-secondary-splitter-color"]};\n        }\n      `;case"tertiary":return`\n        background-color: ${n["button-tertiary-background-color"]};\n\n        & .aether-split-button__splitter {\n          border-left-color: ${n["splitbutton-tertiary-splitter-color"]};\n        }\n      `;default:return null}}(e.type,e.theme))),Ve=_e().div.withConfig({displayName:"SplitButton__StyledButtonSplitter",componentId:"sc-1uqtf3s-1"})(["border-width:",";border-left-style:",";height:20px;"],(e=>`${e.theme["border-width-default"]}`),(e=>`${e.theme["border-style-solid"]}`));function je(e){const n=(0,c.useRef)(),{text:t,onClick:r,children:o,type:a,icon:i,tooltip:s,minWidth:l,className:u,isLoading:p,isDisabled:m,secondaryButton:v,autoFocus:b,"data-testid":h,"data-click":y}=e,g=d().Children.map(o,(e=>d().isValidElement(e)&&e.type===Ne?d().cloneElement(e,{placement:"bottom-end",...!v&&{triggerRef:n}}):e));return d().createElement(Pe,{type:a,className:u,"data-aether-id":"aether-splitButton","data-testid":h,"data-click":y},d().createElement(De.Z,{type:a,text:t,icon:i,isLoading:p,isDisabled:m,minWidth:l,onClick:r,tooltip:s,className:"aether-split-button__primary-btn",autoFocus:b}),!m&&!p&&d().createElement(Ve,{className:"aether-split-button__splitter"}),function(e,n,t){if(e&&e.type===De.Z){const{icon:t}=e.props;return d().cloneElement(e,{type:n,icon:t||d().createElement(Le.Z,null),className:"aether-split-button__secondary-btn"})}return d().createElement(De.Z,{type:n,icon:d().createElement(Le.Z,null),ref:t,className:"aether-split-button__secondary-btn"})}(v,a,n),g)}je.displayName="SplitButton";const Fe=je;je.defaultProps={text:"",type:"secondary",icon:null,tooltip:"",minWidth:"",className:"",isLoading:!1,isDisabled:!1,secondaryButton:null,autoFocus:!1,"data-testid":"aether-split-button","data-click":""},je.propTypes={text:xe().string,onClick:xe().func.isRequired,children:xe().node.isRequired,type:xe().oneOf(["primary","secondary","tertiary"]),icon:xe().node,tooltip:xe().oneOfType([xe().string,xe().object]),minWidth:xe().string,className:xe().string,isLoading:xe().bool,isDisabled:xe().bool,secondaryButton:xe().node,autoFocus:xe().bool,"data-testid":xe().string,"data-click":xe().string};var $e=t(7560),Me=t(7818),Ue=d().createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d().createElement("g",{clipPath:"url(#clip0_3652_80)"},d().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14 2L2 2.00004V14H6V15H2C1.44772 15 1 14.5523 1 14V2.00004C1 1.44776 1.44771 1.00004 2 1.00004L14 1C14.5523 0.999998 15 1.44771 15 2V9H14V2ZM11 16C7.875 16 6 12.5 6 12.5C6 12.5 7.5625 9 11 9C14.4375 9 16 12.5 16 12.5C16 12.5 14.125 16 11 16ZM7.94047 11.4339C7.59128 11.8064 7.33019 12.182 7.15622 12.4663L7.16698 12.482C7.36759 12.7751 7.66306 13.1639 8.04157 13.5493C8.81714 14.339 9.82494 15 11 15C12.1751 15 13.1829 14.339 13.9584 13.5493C14.3369 13.1639 14.6324 12.7751 14.833 12.482L14.8438 12.4663C14.6698 12.182 14.4087 11.8064 14.0595 11.4339C13.3515 10.6787 12.3472 10 11 10C9.65281 10 8.64852 10.6787 7.94047 11.4339ZM12.5 12.5C12.5 13.3284 11.8284 14 11 14C10.1716 14 9.5 13.3284 9.5 12.5C9.5 11.6716 10.1716 11 11 11C11.8284 11 12.5 11.6716 12.5 12.5ZM3 4H6V3H3V4ZM6 7H3V6H6V7ZM3 10H6V9H3V10ZM13 4H8V3H13V4ZM8 7H13V6H8V7Z",fill:"#6B6B6B"})),d().createElement("defs",null,d().createElement("clipPath",{id:"clip0_3652_80"},d().createElement("rect",{width:"16",height:"16",fill:"white"})))),Be=d().forwardRef((function(e,n){return d().createElement(Me.Z,(0,$e.Z)({},e,{svg:Ue,ref:n}))}));Be.getName=function(){return"icon-action-viewEnvironment-stroke"};const We=Be,He=_e()(We).withConfig({displayName:"dropdown-button__QuickLookIcon",componentId:"sc-1l4ht93-0"})(["padding:0 var(--spacing-xs);"]),Ge=_e()(Fe).withConfig({displayName:"dropdown-button__StyledSplitButton",componentId:"sc-1l4ht93-1"})(["flex:1;min-width:0;button:first-child > span{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}&:hover{.aether-split-button__splitter{border-left-color:var(--vscode-button-separator);}}"]),qe=({value:e,isLoading:n,onClick:t,isSecondaryButtonDisabled:r,onSecondaryButtonClick:o,ref:a})=>{const{label:i,forkLabel:s}=e,l=s?`${i} [${s}]`:i;return(0,W.jsx)(Ge,{ref:a,type:"secondary",minWidth:"0px",tooltip:l,text:l,secondaryButton:(0,W.jsx)(De.Z,{type:"secondary",icon:(0,W.jsx)(He,{}),onClick:o,"data-testid":"quick-look-button",isDisabled:r}),isLoading:n,onClick:t})},Qe=_e().div.withConfig({displayName:"dropdown-menu-footer__DropdownMenuFooterWrapper",componentId:"sc-1xyks5e-0"})(["display:flex;padding:var(--spacing-l);background-color:var(--highlight-background-color-secondary);border-radius:0 0 var(--border-radius-default) var(--border-radius-default);"]),Ke=({text:e,isLoading:n,isDisabled:t,onClick:r})=>(0,W.jsx)(Qe,{children:(0,W.jsx)(De.Z,{type:"text",text:e,onClick:r,isLoading:n,isDisabled:t})});var Ye=t(9335);const Ze=_e()(Ye.Z).withConfig({displayName:"dropdown-menu-filter__FilterInput",componentId:"sc-1kj566z-0"})(["border-color:transparent;border-radius:var(--border-radius-default) var(--border-radius-default) 0 0;&:active,&:focus,&:hover,&:focus-within{box-shadow:none;border-color:transparent;}"]),ze=({value:e,onChange:n})=>{const t=d().useRef(null);return d().useEffect((()=>{t.current&&t.current.focus()}),[]),(0,W.jsx)(Ze,{ref:t,type:"search",value:e,onChange:n,placeholder:"Search"})};var Xe=t(1397),Je=t(7691);const en=_e().div.withConfig({displayName:"menu-item-label__LabelWrapper",componentId:"sc-1eo09n5-0"})(["box-sizing:border-box;display:flex;align-items:center;overflow:hidden;cursor:pointer;"]),nn=_e().p.withConfig({displayName:"menu-item-label__Label",componentId:"sc-1eo09n5-1"})(["flex:2;margin:0;margin-right:var(--spacing-s);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:fit-content;"]),tn=_e().p.withConfig({displayName:"menu-item-label__ForkLabel",componentId:"sc-1eo09n5-2"})(["flex:1;white-space:nowrap;overflow:hidden;margin:0;margin-left:var(--spacing-xs);font-size:var(--text-size-s);font-weight:var(--text-weight-regular);text-overflow:ellipsis;color:var(--content-color-tertiary);max-width:fit-content;"]),rn=({label:e,forkLabel:n})=>e?(0,W.jsxs)(en,{children:[(0,W.jsx)(Xe.Z,{content:e,openDelay:1e3,placement:"bottom",children:(0,W.jsx)(nn,{children:e})}),n&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Je.Z,{color:"content-color-tertiary",size:"small","data-testid":"fork-icon"}),(0,W.jsx)(Xe.Z,{content:n,openDelay:1e3,placement:"bottom",children:(0,W.jsx)(tn,{children:n})})]})]}):null,on=_e().div.withConfig({displayName:"dropdown-menu-item__DropdownMenuItemWrapper",componentId:"sc-1si47dy-0"})(["flex:1;color:var(--content-color-primary);min-height:28px;box-sizing:border-box;padding:var(--spacing-xs) var(--spacing-s);border-radius:var(--border-radius-default);display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer;user-select:none;"," &:hover{background-color:var(--highlight-background-color-secondary);}&:active{background-color:var(--highlight-background-color-tertiary);}"],(({isSelected:e})=>e&&"background-color: var(--highlight-background-color-primary);")),an=({isSelected:e,label:n,forkLabel:t,onSelect:r})=>(0,W.jsx)(on,{isSelected:e,role:"menuitem",onClick:r,tabIndex:0,onKeyPress:e=>{if("Enter"===e.key||" "===e.key)return e.preventDefault(),e.stopPropagation(),r()},children:(0,W.jsx)(rn,{label:n,forkLabel:t})}),sn=_e().div.withConfig({displayName:"dropdown-menu__DropdownMenuWrapper",componentId:"sc-58knxo-0"})(["display:flex;flex-direction:column;max-height:75vh;width:90vw;max-width:320px;"]),ln=_e().div.withConfig({displayName:"dropdown-menu__MenuList",componentId:"sc-58knxo-1"})(["flex:1;display:flex;flex-direction:column;padding:var(--spacing-s);overflow-y:auto;background:var(--background-color-primary);:empty::before{content:'No items found';flex:1;min-height:28px;box-sizing:border-box;padding:var(--spacing-xs) var(--spacing-s);color:var(--content-color-tertiary);}"]),cn=_e().div.withConfig({displayName:"dropdown-menu__HeaderInfoText",componentId:"sc-58knxo-2"})(["padding:var(--spacing-s) var(--spacing-l);color:var(--content-color-secondary);background-color:var(--highlight-background-color-secondary);font-weight:var(--text-weight-bold);user-select:none;"]),dn=_e().div.withConfig({displayName:"dropdown-menu__LoadingErrorWrapper",componentId:"sc-58knxo-3"})(["text-align:center;padding:var(--spacing-m);"]),un=_e().div.withConfig({displayName:"dropdown-menu__FilterWrapper",componentId:"sc-58knxo-4"})(["border-radius:var(--border-radius-default) var(--border-radius-default) 0 0;",";"],(e=>e.isBleed?" ":"border-bottom: var(--border-width-default) var(--border-style-solid) var(--border-color-default);")),pn=({options:e,onChange:n,value:t,isError:r,refetch:o,headerInfoText:a,isCreateNewLoading:i,isCreateNewDisabled:s,onCreateNew:l,createNewText:c="Create New"})=>{const[u,p]=d().useState(""),m=e.filter((({label:e})=>e.toLowerCase().includes(String(u).toLowerCase())));return(0,W.jsxs)(sn,{role:"menu",id:"selectormenu","aria-labelledby":"menubutton",children:[(0,W.jsx)(un,{isBleed:Boolean(a),children:(0,W.jsx)(ze,{value:u,onChange:e=>p(e.target.value)})}),a&&(0,W.jsx)(cn,{children:a}),r?(0,W.jsxs)(dn,{children:["Failed to load. ",(0,W.jsx)(De.Z,{type:"text",text:"Retry",onClick:o})]}):(0,W.jsx)(ln,{children:m.map((e=>(0,W.jsx)(an,{value:e.value,label:e.label,forkLabel:e.forkLabel,onSelect:()=>(p(""),n(e)),isSelected:e.value===t.value},e.value)))}),l&&(0,W.jsx)(Ke,{text:c,onClick:l,isLoading:i,isDisabled:s})]})},mn=_e().div.withConfig({displayName:"selector__TriggerWrapper",componentId:"sc-bffnwo-0"})(["display:flex;flex:1;max-width:260px;"]),vn=({value:e,options:n,onChange:t,isLoading:r,isError:o,refetch:a,headerInfoText:i,isCreateNewLoading:s,isCreateNewDisabled:l,onCreateNew:c,isQuickLookDisabled:u,onQuickLookClick:p,menuPlacement:m,"aria-label":v})=>{const[b,h]=d().useState(!1),y=(0,W.jsx)(mn,{children:(0,W.jsx)(qe,{value:e,isLoading:r,onClick:()=>h((e=>!e)),isSecondaryButtonDisabled:u,onSecondaryButtonClick:()=>(b&&h(!1),p()),"aria-haspopup":"menu","aria-controls":"selectormenu","aria-expanded":b,"aria-label":v})});return(0,W.jsx)(Ne,{placement:m,trigger:y,isOpen:b,onClickOutside:()=>h(!1),padding:"0",appendTo:"parent",children:b&&(0,W.jsx)(pn,{isCreateNewLoading:s,isCreateNewDisabled:l,onCreateNew:c,headerInfoText:i,options:n,isError:o,refetch:a,onChange:(...e)=>(h(!1),t(...e)),value:e})})},bn=e=>({queryKey:[b,e],queryFn:({signal:n})=>(async(e,{signal:n}={})=>{var t,r;if(!e)throw new Error("Invalid environment id");const o=await m.postmanGateway.get({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`,signal:n});null==o||o.data;const a=S(o.data);return await(0,k.updateDependentSession)({model:"environment",modelId:a.id},a),Object.assign({},a,{forkedFrom:null!=(t=null==(r=o.meta)?void 0:r.forkedFrom)?t:null})})(e,{signal:n}),useErrorBoundary:!1}),hn=e=>Object.assign({},bn(null!=e?e:""),{enabled:!!e}),yn=e=>({queryKey:[y,e],queryFn:({signal:n})=>(async(e,{signal:n}={})=>{var t;const r=await m.postmanGateway.get({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/workspace/${e}/globals`,signal:n});if(!Array.isArray(null==r||null==(t=r.data)?void 0:t.values))throw new TypeError("Received invalid globals data from server");const o=r.data;return await(0,k.updateDependentSession)({model:"globals",modelId:o.id},o),o})(e,{signal:n}),useErrorBoundary:!1}),gn=async({signal:e,permissionsPayload:n})=>{const t=await m.postmanGateway.post({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",service:"acs",data:{body:{checks:Object.assign({},n)}},signal:e});if(null==t||!t.results)throw new Error("Received invalid permissions");return t.results},wn="workspace",fn="ADD_ENVIRONMENT_TO_WORKSPACE",En="UPDATE_GLOBALS",Cn=(e,n)=>{const t={};for(const[r,o]of Object.entries(n))t[o]={entityId:window.USER_ID,entityType:"user",objectId:e,objectType:wn,permission:r};return t},kn=e=>({queryKey:[h,g,e],queryFn:async({signal:n})=>{if(!window.USER_ID)return{userCanCreateEnvironment:!0,userCanUpdateGlobals:!0};const t={[fn]:`${wn}/${e}/${fn}`,[En]:`${wn}/${e}/${En}`},r=await gn({signal:n,permissionsPayload:Cn(e,t)});return{userCanCreateEnvironment:r[t[fn]].allowed,userCanUpdateGlobals:r[t[En]].allowed}},useErrorBoundary:!1}),In="workspace",_n="ADD_ENVIRONMENT_TO_WORKSPACE",Sn="UPDATE_ENVIRONMENT",xn="DELETE_ENVIRONMENT",An=e=>e.includes(In),On=(e,n)=>({queryKey:[w,e],queryFn:async({signal:t})=>{if(!window.USER_ID)return{userCanCreate:!0,userCanUpdate:!0,userCanDelete:!0};const r={[_n]:`${In}/${n}/${_n}`,[Sn]:`${e}:${Sn}`,[xn]:`${e}:${xn}`},o=((e,n,t)=>{const r={};for(const[o,a]of Object.entries(t))r[a]={entityId:window.USER_ID,entityType:"user",permission:o,objectId:An(a)?n:e,objectType:An(a)?In:"environment"};return r})(e,n,r),a=await gn({signal:t,permissionsPayload:o});return{userCanCreate:a[r[_n]].allowed,userCanUpdate:a[r[Sn]].allowed,userCanDelete:a[r[xn]].allowed}},useErrorBoundary:!1}),Tn="workspace",Rn="UPDATE_GLOBALS",Nn=(e,n)=>{const t={};for(const[r,o]of Object.entries(n))t[o]={entityId:window.USER_ID,entityType:"user",objectId:e,objectType:Tn,permission:r};return t},Ln=e=>({queryKey:[f,e],queryFn:async({signal:n})=>{if(!window.USER_ID)return{userCanUpdate:!0};const t={[Rn]:`${Tn}/${e}/${Rn}`};return{userCanUpdate:(await gn({signal:n,permissionsPayload:Nn(e,t)}))[t[Rn]].allowed}},useErrorBoundary:!1}),Dn="workspace",Pn="ADD_ENVIRONMENT_TO_WORKSPACE",Vn=e=>({queryKey:[E,e],queryFn:async({signal:n})=>{if(!window.USER_ID)return{userCanCreate:!0};const t={[Pn]:`${Dn}/${e}/${Pn}`},r=((e,n)=>{const t={};for(const[r,o]of Object.entries(n))t[o]={entityId:window.USER_ID,entityType:"user",permission:r,objectId:e,objectType:Dn};return t})(e,t);return{userCanCreate:(await gn({signal:n,permissionsPayload:r}))[t[Pn]].allowed}},useErrorBoundary:!1});var jn=t(1466);const Fn=()=>({queryKey:["dynamic"],queryFn:()=>(async()=>await jn.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"FETCH_DYNAMIC_VARIABLES",payload:{}}))()}),$n={userCanCreate:!0},Mn=e=>Boolean(e.isLoading);var Un=t(809);const Bn="environment-selector-value-paint-mark",{PerfContext:Wn,PerformanceMarkPaint:Hn}=Un.perfComponents,Gn=()=>{performance.measure("environment-selector-value-paint-time",{},Bn),(0,Un.sendMeasureEvent)({name:Bn,entityType:"generic-selector"})},qn=Object.freeze({label:"No Environment",value:"",forkLabel:""}),Qn=()=>{var e;const n=(0,K.useNavigate)(),t=(0,p.useActiveWorkspaceId)(),r=(0,c.useContext)(H),o=r&&!r.useActiveEnvironmentFromContext;ne(t);const{data:a,isError:i,refetch:s}=U({workspaceId:t}),l=!a,{data:d}=B(),m=te(),v=(0,c.useMemo)((()=>{var e;return[qn,...null!=(e=null==a?void 0:a.map((e=>{var n;const t=Mn(e)?null:null==(n=e.attributes)||null==(n=n.fork)?void 0:n.forkLabel;return{label:e.name,value:e.id,forkLabel:null!=t?t:""}})))?e:[]]}),[a]),b=X(),{isLoading:h,userCanCreate:y}=(()=>{const e=(0,p.useActiveWorkspaceId)(),{data:n,error:t}=(0,u.useDataFetch)(Vn(e));return t?Object.assign({isLoading:!1},$n):n?Object.assign({isLoading:!1},n):Object.assign({isLoading:!0},$n)})(),g=(e,r)=>{const o={rename:(null==r?void 0:r.showRenameOptionOnOpen)||!1};n(`/workspace/${t}/environment/${e}`,{state:JSON.stringify({additionalContext:o})},{customNavEvent:K.OPEN_EXTENSION_URL})},w=null!=(e=v.find((e=>e.value===(null==d?void 0:d.id))))?e:qn,f=l&&!i,{markName:E,callback:C}=(0,c.useContext)(Wn);return(0,W.jsx)("div",{"data-testid":"active-environment-selector",children:(0,W.jsx)(Hn,{condition:!f,markName:E||Bn,callback:C||Gn,children:(0,W.jsx)(vn,{options:v,value:w,isLoading:f,isError:i,refetch:s,onChange:e=>{m.mutate(null!=e&&e.value?{id:e.value}:null)},menuPlacement:"bottom-end","aria-label":"active-environment",isQuickLookDisabled:!d||l,onQuickLookClick:()=>{d&&g(d.id)},headerInfoText:o?"Switch environment for the entire collection":void 0,isCreateNewLoading:b.isLoading||h,isCreateNewDisabled:!y,onCreateNew:()=>{b.mutate({workspaceId:t,requestBody:{id:(0,Q.v4)(),name:"New Environment",values:[]}},{onSuccess:({data:e})=>{Y.AnalyticsService.addEventV2({category:"environment",action:"create",label:"environment-selector"}),g(`${e.owner}-${e.id}`,{showRenameOptionOnOpen:!0})}})}})})})},Kn=e=>Z()?(0,W.jsx)(Qn,Object.assign({},e)):null,Yn=e=>null==e?void 0:e.map((e=>({key:e.key,value:e.value,enabled:e.enabled,type:e.type}))),Zn=async(e,n)=>{if(!e.id)throw new Error("updateEnvironment: id is required");const t=(e=>{const{values:n}=e;return Object.assign({},e,{values:Yn(n)})})(e),r=(o=(await m.postmanGateway.put({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/environment/${t.id}`,body:JSON.stringify({name:t.name,values:t.values})})).data,Object.assign({},o,{id:`${o.owner}-${o.id}`}));var o;return null!=n&&n.avoidSession||await(0,k.updateDependentSession)({model:"environment",modelId:r.id},r),r},zn=()=>({mutationFn:Zn,onSuccess:e=>{u.cacheClient.setQueryData(["environment",e.id],e)}}),Xn=()=>({mutationFn:async(e,n,t=!1)=>{const r=e.id;if(t)return await(0,k.setSession)({model:"environment",modelId:r},n),null;const[o]=await Promise.all([Zn(e,{avoidSession:!0}),(0,k.setSession)({model:"environment",modelId:r},n)]);return{environment:o}},onSuccess:e=>{if(e){const{environment:n}=e;(0,u.updateCache)({key:[b,n.id],updater:e=>e?Object.assign({},e,n):e})}}}),Jn=e=>e.map((e=>({key:e.key,value:e.value,enabled:e.enabled,type:e.type}))),et=e=>{const{values:n,workspace:t}=e;return{workspace:t,values:Jn(n)}},nt=async(e,n)=>{const t=e.workspace,r=(await m.postmanGateway.put({url:`${_().HTTPS_GATEWAY_PRIVATE_URL}/workspace/${t}/globals`,body:JSON.stringify(et(e))})).data;return null!=n&&n.avoidSession||await(0,k.updateDependentSession)({model:"globals",modelId:r.id},r),r},tt=()=>({mutationFn:nt,onSuccess:e=>{u.cacheClient.setQueryData([y,e.workspace],e)}}),rt=()=>({mutationFn:async(e,n,t=!1)=>{if(t)return await(0,k.setSession)({model:"globals",modelId:e.id},n),null;const[r]=await Promise.all([nt(e,{avoidSession:!0}),(0,k.setSession)({model:"globals",modelId:e.id},n)]);return{globals:Object.assign({},r,{workspace:e.workspace})}},onSuccess:e=>{if(e){const{globals:n}=e;(0,u.updateCache)({key:["globals",n.workspace],updater:n})}}}),ot=(e,n)=>{(0,u.updateCache)({key:e,updater:e=>e?Object.assign({},e,{name:n}):e})},at=()=>({mutationFn:e=>ge(e),onMutate:async({environmentId:e,name:n})=>{const t=[b,e],r=u.cacheClient.getQueryData(t);return ot(t,n),()=>{r&&ot(t,r.name)}},onSuccess:(e,{environmentId:n})=>{ot([b,n],e.data.name)},onError:(e,n,t)=>{t&&t()}});async function it(e,n,t){jn.VSCodeCommunicationsService.postMessageToExtension({type:"RESOLVE_VARIABLES",payload:{objectToResolve:e,variables:n,id:t}})}const st=async(...e)=>{const n=await Zn(...e);return(0,u.updateCache)({key:[b,n.id],updater:()=>n}),n},lt=async(...e)=>{const n=await nt(...e);return(0,u.updateCache)({key:[y,n.workspace],updater:()=>n}),n},ct=(0,k.createVariableUpdatesHandler)({model:"environment",hasEditPermission:async(e,{workspaceId:n})=>{var t;const r=await u.cacheClient.fetchQuery(On(e,n)).catch((()=>null));return null==(t=null==r?void 0:r.userCanUpdate)||t},getValues:async e=>await u.cacheClient.fetchQuery(bn(e)).catch((()=>null)),setValues:(e,n)=>st({id:e,values:n})}),dt=(0,k.createVariableUpdatesHandler)({model:"globals",hasEditPermission:async(e,{workspaceId:n})=>{var t;const r=await u.cacheClient.fetchQuery(Ln(n)).catch((()=>null));return null==(t=null==r?void 0:r.userCanUpdate)||t},getValues:async(e,{workspaceId:n})=>await u.cacheClient.fetchQuery(yn(n)).catch((()=>null)),setValues:(e,n,{workspaceId:t})=>lt({id:e,values:n,workspace:t})}),ut=async e=>{if(!e)return;const n=await u.cacheClient.fetchQuery(bn(e));return(0,k.getActiveSession)({model:"environment",modelId:n.id},n)},pt=async e=>{const n=await u.cacheClient.fetchQuery(yn(e));return(0,k.getActiveSession)({model:"globals",modelId:n.id},n)};var mt=function(e){return e.GLOBALS="globals",e.WORKSPACE="workspace",e}(mt||{});const vt=(e,{workspaceId:n})=>{var t,r;const o=null==e||null==(t=e.meta)?void 0:t.model,a=null==e||null==(r=e.meta)?void 0:r.action;if(o===mt.GLOBALS&&a===T.UPDATE){const t=null==e?void 0:e.data;A(n,t)}o===mt.WORKSPACE&&a===L.UPDATE_ROLES&&(u.cacheClient.invalidateQueries({queryKey:[w]}),(0,u.invalidateCache)([f,n]))}}}]);
//# sourceMappingURL=9603.ede3a1d361eb5bb8.js.map